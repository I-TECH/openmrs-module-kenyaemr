<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.

-->
<htmlform>

    <script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script>
    <link rel="stylesheet" type="text/css" href="../moduleResources/kenyaemr/styles/kenyaemr_ml_scoring.css"></link>
    <script type="text/javascript">
        var IS_KDoD_SITE = <lookup expression="kenyaemr.getFacilityType()" />;
        var IS_Recency_SITE = <lookup expression="kenyaemr.getRecencySite()" />;
        var mflCode = <lookup expression="kenyaemr.currentFacilityMFLCode()" />;
        var ctxPath = typeof openmrsContextPath === 'string' ? openmrsContextPath : OPENMRS_CONTEXT_PATH;
        var patientId = <lookup expression="patient.patientId"/>;

        var populationTypeSelected = function () {
            var val = jq(this).val();
            var keypop = jq('#key-population');
            var pripop = jq('#priority-population');
            if (val == 164929 ){
                jq("#key-population").show();
                jq("#priority-population").hide();
            }
            if (val == 138643 ){
                jq("#priority-population").show();
                jq("#key-population").hide();
            }
            if(val == 164928){
                jq("#key-population").hide();
                jq("#priority-population").hide();
                clearHiddenSections(keypop);
                clearHiddenSections(pripop);
            }
        }
        var hasDisabilitySelected = function () {
            var val = jq(this).val();
            if (val == 1066 ){
                jq('#disability').hide();
                jq('#tbl-other-disability').hide();
                jq('#disability select').prop("disabled", true);
                jq('#disability select').val('');
                clearHiddenSections(jq('#disability'));
            }else{
                jq('#disability').show();
                jq('#disability select').prop("disabled", false);
            }
        }

        var willingnessToShareSelfTestResults = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq("#test-results").show();
            }else {
                jq("#test-results").hide();
                clearHiddenSections(jq('#results'));
                clearHiddenSections(jq('#date-of-self-test'));
            }

        };

        //Setting
        var onSettingSelected = function() {
            var val = jq(this).val();
            jq("#strategy option[value='161557']").show();  //IT
            jq("#strategy option[value='159939']").show();  //MO
            jq("#strategy option[value='166606']").show();  //SNS
            jq("#strategy option[value='5622']").show();     //O
            jq("#hts-entry-point option[value='5622']").show();     //O
            if (val == 1537 ) {   //Facility setting selected
                clearHiddenSections(jq('#strategy'));
                clearHiddenSections(jq('#hts-entry-point'));
                //Strategy
                jq("#strategy option[value='164163']").show();  //PITC
                jq("#strategy option[value='164953']").show();  //NP
                jq("#strategy option[value='164954']").show();   //VI
                jq("#strategy option[value='164955']").hide();    //VS
                jq("#strategy option[value='159938']").hide();    //HB
                //Entry point
                jq("#hts-entry-point option[value='5485']").show();    //IPD
                jq("#hts-entry-point option[value='160542']").show();    //OPD
                jq("#hts-entry-point option[value='162181']").show();    //PC
                jq("#hts-entry-point option[value='160552']").show();    //NC
                jq("#hts-entry-point option[value='160538']").show();    //ANC
                jq("#hts-entry-point option[value='160456']").show();    //MAT
                jq("#hts-entry-point option[value='1623']").show();    //PNC
                jq("#hts-entry-point option[value='160541']").show();    //TB
                jq("#hts-entry-point option[value='159940']").show();    //VCT
                jq("#hts-entry-point option[value='162223']").show();    //VMMC
                jq("#hts-entry-point option[value='160546']").show();    //STI
                jq("#hts-entry-point option[value='160522']").show();    //ER
                jq("#hts-entry-point option[value='163096']").hide();    //CT
                jq("#hts-entry-point option[value='159938']").hide();    //HBT
                jq("#hts-entry-point option[value='159939']").hide();    //MO

            }else if(val == 163488 ) {
                clearHiddenSections(jq('#strategy'));
                clearHiddenSections(jq('#hts-entry-point'));
                // strategy
                jq("#strategy option[value='164163']").hide();  //PITC
                jq("#strategy option[value='164953']").hide();  //NP
                jq("#strategy option[value='164954']").hide();   //VI
                jq("#strategy option[value='164955']").show();    //VS
                jq("#strategy option[value='159938']").show();    //HB
                //Entry point
                jq("#hts-entry-point option[value='163096']").show();    //CT
                jq("#hts-entry-point option[value='159938']").show();    //HBT
                jq("#hts-entry-point option[value='159939']").show();    //MO
                jq("#hts-entry-point option[value='5485']").hide();    //IPD
                jq("#hts-entry-point option[value='160542']").hide();    //OPD
                jq("#hts-entry-point option[value='162181']").hide();    //PC
                jq("#hts-entry-point option[value='160552']").hide();    //NC
                jq("#hts-entry-point option[value='160538']").hide();    //ANC
                jq("#hts-entry-point option[value='160456']").hide();    //MAT
                jq("#hts-entry-point option[value='1623']").hide();    //PNC
                jq("#hts-entry-point option[value='160541']").hide();    //TB
                jq("#hts-entry-point option[value='159940']").hide();    //VCT
                jq("#hts-entry-point option[value='162223']").hide();    //VMMC
                jq("#hts-entry-point option[value='160546']").hide();    //STI
                jq("#hts-entry-point option[value='160522']").hide();    //ER

            }
        };

        var isSelfTestDoneInLast12months = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq("#test-results").hide();
                jq("#willingness-share-results").show();
            }else {
                jq("#test-results").hide();
                jq("#willingness-share-results").hide();
                clearHiddenSections(jq('#share-results'));
                clearHiddenSections(jq('#results'));

            }
        };

        var hasOtherDisabilitySelected = function () {
            var val = jq(this).val();
            // Specify other
            if (val == 5622){
                jq('#tbl-other-disability').show();
            }
            if(val != 5622){
                jq('#tbl-other-disability').hide();
                clearHiddenSections(jq('#other-disability'));
            }
        }
        var strategySelected = function () {
            var val = jq(this).val();
            if (val == 159938 ){
                getField('hts-entry-point.value').prop("selectedIndex", 14);
            }else if (val == 159939 ){
                getField('hts-entry-point.value').prop("selectedIndex", 15);
            }else if (val == 164954 || val == 164955){
                getField('hts-entry-point.value').prop("selectedIndex", 9);
            }
            // Specify other
            if (val == 5622){
                jq('#tbl-other-strategy').show();
            }else{
                jq('#tbl-other-strategy').hide();
            }
        }

        var clientConsentChanged = function() {
            var val = getValue('clientConsent.value');
            var htsMLPrediction = "<lookup expression="fn.latestObs(167163).getValueCoded().getConceptId()" />";

            if(val == 'false' &amp;&amp; (htsMLPrediction == '1408' || htsMLPrediction == '167164')) {
                jq('#ml-prediction-consent-warning').html('Client has a high HIV risk score, testing is highly recommended');
                jq('#ml-prediction-consent-warning').show();
            } else {
                jq('#ml-prediction-consent-warning').hide();
                clearHiddenSections(jq('#ml-prediction-consent-warning'));
            }
        }

        var changeTheFinalResult = function (changedValue) {
            if(changedValue != null) {
                if(changedValue == 664) {
                    var htsMLPrediction = "<lookup expression="fn.latestObs(167163).getValueCoded().getConceptId()" />";

                    if(htsMLPrediction == '1408' || htsMLPrediction == '167164') {
                        jq('#ml-prediction-results-warning').html('Client has a high HIV risk score, Kindly refer for preventive services');
                        jq('#ml-prediction-results-warning').show();
                    }
                } else {
                    jq('#ml-prediction-results-warning').hide();
                    clearHiddenSections(jq('#ml-prediction-results-warning'));
                }
                getField('hiv-final-result.value').val(changedValue);
            } else {
                jq('#ml-prediction-results-warning').hide();
                clearHiddenSections(jq('#ml-prediction-results-warning'));
            }
        };

        var kit1Selected = function () {
            var val = jq(this).val();
            // Show use previous lot number checkbox
            if(val != null || val != ""){
                jq("#latest-lot-number").show();
                jq('#latestLotNumber').click(defaultLotNumberClicked);
            }else{
                jq("#latest-lot-number").hide();
                jq('#latest-lot-number :input').prop('checked', false);
            }

            if (val == 165351 ){   //Dual kit selected
                jq('#dual-results-1').show();
                getField("kit-name-2.value").val("");
                jq("#kit-name-2 option[value='164961']").show();
                jq("#kit-name-2 option[value='164960']").hide();
                jq("#kit-name-2 option[value='165351']").hide();
            }

            else if (val == 164960 ){   //Determine kit selected
                jq('#dual-results-1').hide();
                getField("kit-name-2.value").val("");
                jq("#kit-name-2 option[value='164961']").show();
                jq("#kit-name-2 option[value='164960']").hide();
                jq("#kit-name-2 option[value='165351']").hide();
            }

        }
        var kit2Selected = function () {
            var val = jq(this).val();
            // Show use previous lot number checkbox
            if (val != null || val != "") {
                jq("#latest-lot-number2").show();
                jq('#latestLotNumber2').click(defaultLotNumber2Clicked);
            } else {
                jq("#latest-lot-number2").hide();
                jq('#latest-lot-number2 :input').prop('checked', false);
            }
        }

        //Ckeckbox to prepopulate last latestLotNumber-1
        var defaultLotNumberClicked = function () {
            var val = jq(this).val();
            var kitName1 = getField('kit-name-1.value').val();
            jq('#upnError').hide();
            if (jq(this).is(':checked') &amp;&amp; !isNaN(kitName1) ){
                jq.getJSON('/' + ctxPath + '/kenyaemr/emrUtils/lastLotNumberUsedForHTSTesting.action', {kitName: kitName1}, function (data) {

                    if (data.lastLotNumber != null || data.lastLotNumber != "") {
                        jq('#upnError').text("");
                        jq('#lot-number-1 input[type=text]').val(data.lastLotNumber);
                        //Check lot expiry date
                        jq.getJSON('/' + ctxPath + '/kenyaemr/emrUtils/lastLotExpiryDateUsedForHTSTesting.action', {kitName: kitName1}, function (data) {

                            if (data.lastLotExpiryDate != null || data.lastLotExpiryDate != "") {
                                jq('#expiry-date input[type=text]').val(data.lastLotExpiryDate);
                            }
                        });
                    } else {
                        jq('#lot-number-1 input[type=text]').val("");
                        jq('#expiry-date input[type=text]').val("");
                        jq('#upnError').text("");
                        jq('#upnError').text("No previous lot numbers have been saved");
                        jq('#upnError').show();
                    }


                });
            }else{
                getField('lot-number-1.value').val("");
                getField('expiry-date.value').val("");
            }
        }
        //Ckeckbox to prepopulate last latestLotNumber-2
        var defaultLotNumber2Clicked = function () {
            var val = jq(this).val();
            var kitName2 = getField('kit-name-2.value').val();
            jq('#upnError').hide();
            if (jq(this).is(':checked') &amp;&amp; !isNaN(kitName2) ){
                jq.getJSON('/' + ctxPath + '/kenyaemr/emrUtils/lastLotNumberUsedForHTSTesting.action', {kitName: kitName2}, function (data) {

                    if (data.lastLotNumber != null || data.lastLotNumber != "") {
                        jq('#upnError2').text("");
                        jq('#lot-number-2 input[type=text]').val(data.lastLotNumber);
                        //Check lot expiry date
                        jq.getJSON('/' + ctxPath + '/kenyaemr/emrUtils/lastLotExpiryDate2UsedForHTSTesting.action', {kitName: kitName2}, function (data) {

                            if (data.lastLotExpiryDate != null || data.lastLotExpiryDate != "") {
                                jq('#expiry-date2 input[type=text]').val(data.lastLotExpiryDate);
                            }
                        });
                    } else {
                        jq('#lot-number-2 input[type=text]').val("");
                        jq('#expiry-date2 input[type=text]').val("");
                        jq('#upnError2').text("");
                        jq('#upnError2').text("No previous lot numbers have been saved");
                        jq('#upnError2').show();
                    }


                });
            }else{
                getField('lot-number-2.value').val("");
                getField('expiry-date2.value').val("");
            }
        }

        var prevTestSelected = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq('#duration_months input').prop("disabled", false);
            }else{
                jq('#duration_months input').prop("disabled", true);
                clearHiddenSections(jq('#duration_months'));
            }
        }
        var consentSelected = function () {
            var val = jq(this).val();
            if (val == 'true' ){
                jq('#couple-testing input').prop("disabled", false);
                jq('#hiv-test1-result select').prop("disabled", false);
                jq('.kit-name select').prop("disabled", false);
                jq('.lot-number input').prop("disabled", false);
                jq('#expiry-date input').prop("disabled", false);
                jq('#expiry-date2 input').prop("disabled", false);
                jq('#hiv-final-result select').prop("disabled", false);
                jq('.result-given select').prop("disabled", false);
                jq("#couple-discordant input").prop("disabled", false);
                jq("#tb-screening input").prop("disabled", false);
            }
            if (val == 'false' ){
                jq('#couple-testing input').prop("disabled", true);
                jq('#hiv-test1-result select').prop("disabled", true);
                jq('.kit-name select').prop("disabled", true);
                jq('.lot-number input').prop("disabled", true);
                jq('#expiry-date input').prop("disabled", true);
                jq('#hiv-test2-result select').prop("disabled", true);
                jq('.kit-name2 select').prop("disabled", true);
                jq('.lot-number2 input').prop("disabled", true);
                jq('#expiry-date2 input').prop("disabled", true);
                jq('#hiv-final-result select').prop("disabled", true);
                jq('.result-given select').prop("disabled", true);
                jq("#couple-discordant input").prop("disabled", true);
                jq("#tb-screening input").prop("disabled", true);

                clearHiddenSections(jq('#tbl-couple-testing'));
                clearHiddenSections(jq('#hiv-test1-result'));
                clearHiddenSections(jq('.kit-name'));
                clearHiddenSections(jq('.lot-number'));
                clearHiddenSections(jq('#expiry-date'));
                clearHiddenSections(jq('#hiv-test2-result'));
                clearHiddenSections(jq('.kit-name2'));
                clearHiddenSections(jq('.lot-number2'));
                clearHiddenSections(jq('#expiry-date2'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                clearHiddenSections(jq('.result-given'));
                clearHiddenSections(jq('#couple-discordant'));
                clearHiddenSections(jq('#tb-screening'));
            }
        }
        var inCareSelected = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq('#ccc-no input').prop("disabled", false);
            }else{
                jq('#ccc-no input').prop("disabled", true);
            }
        }
        var coupleTestedAction  = function () {
            var testingOption = getValue("couple-testing.value");
            if(testingOption ==164957) {

                jq("#couple-discordant input[value=1065]").prop("disabled", true);
                jq("#couple-discordant input[value=1066]").prop("disabled", true);
                jq("#couple-discordant input[value=1175]").prop("checked", true);
                jq("#couple-discordant input[value=1175]").prop("disabled", false);
            }
            if(testingOption ==164958){
                jq("#couple-discordant input[value=1065]").prop("disabled", false);
                jq("#couple-discordant input[value=1066]").prop("disabled", false);
                jq("#couple-discordant input[value=1175]").prop("checked", false);
                jq("#couple-discordant input[value=1175]").prop("disabled", true);
            }
        }
        var firstTestSelected  = function () {
            var firstTest = getField("hiv-test1-result.value").val();
            //Negative
            if(firstTest == 664) {
                jq("#hiv-test2").hide();
                jq('#negative-referral').show();
                jq('#fs-referral').hide();
                clearHiddenSections(jq('#ccc-no'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                clearHiddenSections(jq('#hiv-test2-result'));
                clearHiddenSections(jq('.kit-name2'));
                clearHiddenSections(jq('.lot-number2'));
                // getField('hiv-final-result.value').val(664);
                changeTheFinalResult(664);
                jq('#ccc-no input').prop("disabled", true);
            }
            //Positive
            if(firstTest ==703){
                jq("#hiv-test2").show();
                jq("#hiv-test2-result select").prop("disabled", false);
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                clearHiddenSections(jq('#hiv-test2-result'));
                jq('#negative-referral').hide();
                jq('#fs-referral').hide();
            }
            //Invalid
            if(firstTest ==163611){
                jq("#hiv-test2").show();
                jq("#hiv-test2-result select").prop("disabled", false);
                jq("kit-name2 select").prop("disabled", false);
                jq("lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                clearHiddenSections(jq('#ccc-no'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                clearHiddenSections(jq('#hiv-test2-result'));
            }
        }
        var secondTestSelected  = function () {
            var secondTest = getField("hiv-test2-result.value").val();
            //Negative
            if(secondTest == 664) {
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                clearHiddenSections(jq('#ccc-no'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                // getField('hiv-final-result.value').val(1138);
                changeTheFinalResult(664);
                jq('#ccc-no input').prop("disabled", true);
                jq('#tbl-discordant').hide();
                clearHiddenSections(jq('.result-given'));
                clearHiddenSections(jq('#couple-discordant'));
                jq('#negative-referral').hide();
                jq('#fs-referral').hide();
                jq('#hts-recency-testing').hide();
            }
            //Positive
            if(secondTest == 703){
                clearHiddenSections(jq('#ccc-no'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                // getField('hiv-final-result.value').val(703);
                changeTheFinalResult(703);
                jq('#ccc-no input').prop("disabled", false);
                jq('#fs-referral').show();
                jq('#negative-referral').hide();
                jq('#tbl-results-given').show();
                jq('#tbl-discordant').show();
                if(IS_Recency_SITE==true){
                        jq('#hts-recency-testing').show();
                    } else {
                        jq('#hts-recency-testing').hide();
                    }
            }
            //Invalid
            if(secondTest == 163611){
                clearHiddenSections(jq('#ccc-no'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                // getField('hiv-final-result.value').val(1138);
                changeTheFinalResult(1138);
                jq('#tbl-discordant').hide();
                jq('#hts-recency-testing').hide();
            }
            //Invalid
            if(secondTest == 1175){
                clearHiddenSections(jq('#ccc-no'));
                clearHiddenSections(jq('#hiv-final-result'));
                changeTheFinalResult(null);
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                // getField('hiv-final-result.value').val(1138);
                changeTheFinalResult(1138);
                jq('#tbl-discordant').hide();
                jq('#hts-recency-testing').hide();
            }
        }

        var kit1ExpiryDateSelected  = function () {
            var encounterDate = getValue('encounter-date.value');
            var testKit1ExpiryDate = getValue('expiry-date.value');
            var isTestKit1ExpiryBeforeEncounterDate = moment(moment(moment(testKit1ExpiryDate, 'YYYY-MM-DD').toDate()).format('YYYY-MM-DD')).isBefore(moment(moment(encounterDate, 'YYYY-MM-DD').toDate()).format('YYYY-MM-DD'));
            if (isTestKit1ExpiryBeforeEncounterDate) {
                getField('expiry-date.error').html('HIV Test Kit 1 expiry date should not be earlier than encounter Date').show();
            }
        }

        var kit2ExpiryDateSelected  = function () {
            var encounterDate = getValue('encounter-date.value');
            var testKit2ExpiryDate = getValue('expiry-date2.value');
            var isTestKit2ExpiryBeforeEncounterDate = moment(moment(moment(testKit2ExpiryDate, 'YYYY-MM-DD').toDate()).format('YYYY-MM-DD')).isBefore(moment(moment(encounterDate, 'YYYY-MM-DD').toDate()).format('YYYY-MM-DD'));
            if (isTestKit2ExpiryBeforeEncounterDate) {
                getField('expiry-date2.error').html('HIV Test Kit 2 expiry date should not be earlier than encounter Date').show();
            }
        }

        //Clear hidden sections
        clearHiddenSections = function(parentObj) {
            parentObj.find('input[type=radio]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=checkbox]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=text]').each(function() {
                jq(this).val("");
            });
            parentObj.find('select').each(function() {
                this.selectedIndex =0;
            });
        }

        //On Ready
        $(document).ready(function () {

            var pgender = "<lookup expression="patient.gender" />";
            var pAge = parseInt('<lookup expression="patient.age"/>');
            //pop type
            jq("#key-population").hide();
            jq("#priority-population").hide();
            jq('input[type=radio].key-population').prop("checked", false);
            jq('input[type=radio].priority-population').prop("checked", false);
            jq('#population-type :input[type=radio]').change(populationTypeSelected);
            //disability
            jq('#share-results :input[type=radio]').change(willingnessToShareSelfTestResults);
            jq('#client-done-test :input[type=radio]').change(isSelfTestDoneInLast12months);
            jq('#has-disability input').change(hasDisabilitySelected);
            jq('#has-other-disability :input[type=checkbox]').change(hasOtherDisabilitySelected);
            jq('#disability').hide();
            jq('#tbl-other-disability').hide();
            jq('#fs-referral').hide();
            jq('#negative-referral').hide();
            jq('#tbl-specify-referral').hide();
            jq("#test-results").hide();
            jq("#willingness-share-results").hide();
            jq('#setting :input[type=radio]').change(onSettingSelected);

            //ML
            jq('#clientConsent').change(clientConsentChanged);
            jq('#ml-prediction-consent-warning').hide();
            jq('#ml-prediction-results-warning').hide();

            //strategy
            jq("#strategy option[value='164163']").hide();  //PITC
            jq("#strategy option[value='164953']").hide();  //NP
            jq("#strategy option[value='164954']").hide();   //VI
            jq("#strategy option[value='164955']").hide();    //VS
            jq("#strategy option[value='159938']").hide();    //HB
            jq("#strategy option[value='161557']").hide();  //IT
            jq("#strategy option[value='159939']").hide();  //MO
            jq("#strategy option[value='166606']").hide();  //SNS
            jq("#strategy option[value='5622']").hide();     //O
            //Entry points
            jq("#hts-entry-point option[value='163096']").hide();    //CT
            jq("#hts-entry-point option[value='159938']").hide();    //HBT
            jq("#hts-entry-point option[value='159939']").hide();    //MO
            jq("#hts-entry-point option[value='5485']").hide();    //IPD
            jq("#hts-entry-point option[value='160542']").hide();    //OPD
            jq("#hts-entry-point option[value='162181']").hide();    //PC
            jq("#hts-entry-point option[value='160552']").hide();    //NC
            jq("#hts-entry-point option[value='160538']").hide();    //ANC
            jq("#hts-entry-point option[value='160456']").hide();    //MAT
            jq("#hts-entry-point option[value='1623']").hide();    //PNC
            jq("#hts-entry-point option[value='160541']").hide();    //TB
            jq("#hts-entry-point option[value='159940']").hide();    //VCT
            jq("#hts-entry-point option[value='162223']").hide();    //VMMC
            jq("#hts-entry-point option[value='160546']").hide();    //STI
            jq("#hts-entry-point option[value='160522']").hide();    //ER
            jq("#hts-entry-point option[value='5622']").hide();    //O
            jq('#tbl-neg-services-referred').hide();


            //pre-populate from HIV Initial
            var prev_disability = "<lookup expression="fn.latestObs(164951).getValueCoded()"/>";
            var prev_disabilityType = "<lookup expression="fn.latestObs(162558).getValueCoded()"/>";
            var prev_populationType = "<lookup expression="fn.latestObs(164930).getValueCoded()"/>";
            var prev_keyPopulationType = "<lookup expression="fn.latestObs(160581).getValueCoded()"/>";
            var prev_EverTested = "<lookup expression="fn.latestObs(164401).getValueCoded()"/>";
            //Prepopulated fileds from the HTS forms

            if (prev_disability == 1065) {
                jq("#has-disability input[value=1065]").prop("checked", true);
                jq('#disability').show();
            }
            if (prev_disabilityType != "" || prev_disabilityType != null) {
                jq("#disability input[type=checkbox][value='+ prev_disabilityType+']").prop("checked",true);
            }
            if (prev_disability == 1066) {
                jq("#has-disability input[value=1066]").prop("checked", true);
                jq('#disability').hide();
            }
            if (prev_populationType == 164929) {
                jq("#population-type input[value=164929]").prop("checked", true);
                jq('#key-population').show();
            }
            if (prev_populationType == 164928) {
                jq("#population-type input[value=164928]").prop("checked", true);
                jq('#key-population').hide();
            }
            if (prev_keyPopulationType != "" || prev_keyPopulationType != null) {
                jq("#key-population input[type=checkbox][value='+prev_keyPopulationType+']").prop("checked",true);
            }
            if (prev_EverTested == 1065) {
                jq("#ever-tested input[value=1065]").prop("checked", true);
            }

            //ever tested
            jq('#ever-tested input').change(prevTestSelected);
            //strategy selected
            jq('.hts-strategy select').change(strategySelected);
            jq('#referral-to select').change(referralSelected);
            jq('#neg-referral-for  :input[type=radio]').change(hasNegativeReferralSelected);
            jq('#neg-services-referred :input[type=checkbox]').change(negativeReferralServicesSelected);
            jq('#tbl-this-facility').hide();
            jq('#tbl-other-facility').hide();
            jq('#tbl-other-strategy').hide();

            var htsStrategySelected = getField('strategy.value').val();
            if (htsStrategySelected == 159938 ){
                getField('hts-entry-point.value').prop("selectedIndex", 14);
            }else if (htsStrategySelected == 159939 ){
                getField('hts-entry-point.value').prop("selectedIndex", 15);
            }else if (htsStrategySelected == 164954 || htsStrategySelected == 164955){
                getField('hts-entry-point.value').prop("selectedIndex", 9);
            }
            // Specify other
            if (htsStrategySelected == 5622){
                jq('#tbl-other-strategy').show();
            }else{
                jq('#tbl-other-strategy').hide();
            }

            jq('#has-other-disability :input[type=checkbox]').change(otherDisabilitySelected);
            var hasDisability = getValue('has-disability.value');
            // Specify other
            if (hasDisability == 1065){
                jq('#disability').show();
                jq('#tbl-other-disability').show();
            }

            var otherDisabilitySelected = function() {
                var val = jq(this).val();
                if (val == 5622) {
                    jq('#disability').show();
                    jq('#tbl-other-disability').show();
                } else {
                    jq('#tbl-other-disability').hide();
                }
            }
            //var priority population
            if(IS_KDoD_SITE==false)
            {
                jq('#dodOnly').hide();
            }
            else
            {
                jq('#dodOnly').show();
            }
             //Consent validation
            jq('.consent input').change(consentSelected);
            //couple testing
            jq("#couple-testing input").change(coupleTestedAction);
            //hiv test123    hide second test by default
            //kit selected
            jq('#kit-name-1 select').change(kit1Selected);
            jq('#kit-name-2 select').change(kit2Selected);
            jq("#latest-lot-number").hide();
            jq("#latest-lot-number2").hide();

            jq("#hiv-test2").hide();
            jq('#hiv-final-result select').attr("style", "pointer-events:none;");
            jq("#hiv-test1-result select").change(firstTestSelected);
            jq("#hiv-test2-result select").change(secondTestSelected);
            //jq("#hiv-final-result select").change(finalTestSelected);
            //test kit expiry
            jq("#expiry-date input").change(kit1ExpiryDateSelected);
            jq("#expiry-date2 input").change(kit2ExpiryDateSelected);
            //jq('#ccc-no :input').prop('readonly', true);
            //On Load defaults
            var everTested = getField("hiv-test1-result.value").val();
            if (everTested == 1065 ){
                jq('#prev-test-location input').prop("disabled", false);
                jq('#prev-test-date input').prop("disabled", false);

            }
            if(everTested == 1066 ){
                jq('#prev-test-location input').prop("disabled", true);
                jq('#prev-test-date input').prop("disabled", true);
                clearHiddenSections(jq('#prev-test-location'));
                clearHiddenSections(jq('#prev-test-date'));
            }
            jq('#hts-recency-testing').hide();
            jq("#tbl-recency-id").hide();
            jq("#recency-testing input").change(recencyTestingSelected);
            includePatientsRecencyIdIfExists();
            jq("#rt-id input[type=text]").blur(checkForExistingRecencyIdentifiers);

            //First test
            var firstTest = getField("hiv-test1-result.value").val();
            //Negative
            if(firstTest == 664) {

                jq("#hiv-test2-result select").prop("disabled", true);
                jq(".kit-name2 select").prop("disabled", true);
                jq(".lot-number2 input").prop("disabled", true);
                jq("#expiry-date2 input").prop("disabled", true);
                // getField('hiv-final-result.value').val(664);
                changeTheFinalResult(664);
                jq('#ccc-no input').prop("disabled", true);
                jq('#negative-referral').show();
                jq('#fs-referral').hide();
            }
            //Positive
            if(firstTest == 703){

                jq("#hiv-test2-result select").prop("disabled", false);
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                jq('#negative-referral').hide();
                jq('#fs-referral').hide();
            }
            //Invalid
            if(firstTest ==163611){

                jq("#hiv-test2-result select").prop("disabled", false);
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
            }
            //Final test
            var secondTest = getField("hiv-test2-result.value").val();
            //Negative
            if(secondTest == 664) {
                jq(".kit-name2 select").prop("disabled", true);
                jq(".lot-number2 input").prop("disabled", true);
                jq("#expiry-date2 input").prop("disabled", true);
                // getField('hiv-final-result.value').val(664);
                changeTheFinalResult(664);
                jq('#ccc-no input').prop("disabled", true);
                jq('#negative-referral').hide();
                jq('#fs-referral').hide();
                jq('#hts-recency-testing').hide();
            }
            //Positive
            if(secondTest == 703){
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                // getField('hiv-final-result.value').val(703);
                changeTheFinalResult(703);
                jq('#ccc-no input').prop("disabled", false);
                jq('#fs-referral').show();
                jq('#negative-referral').hide();
                if(IS_Recency_SITE==true){
                        jq('#hts-recency-testing').show();
                    } else {
                        jq('#hts-recency-testing').hide();
                    }
            }
            //Invalid
            if(secondTest == 163611){
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                // getField('hiv-final-result.value').val(1138);
                changeTheFinalResult(1138);
                jq('#hts-recency-testing').hide();
            }
            //Invalid
            if(secondTest == 1175){
                jq(".kit-name2 select").prop("disabled", false);
                jq(".lot-number2 input").prop("disabled", false);
                jq("#expiry-date2 input").prop("disabled", false);
                // getField('hiv-final-result.value').val(1138);
                changeTheFinalResult(1138);
                jq('#hts-recency-testing').hide();
            }

        });

        var referralSelected = function () {
            var val = jq(this).val();
            var default_location = "<lookup expression="kenyaemr.location()" />";
            if (val == 164407) {
                jq('#tbl-other-facility').show();
                jq('#tbl-this-facility').hide();
                getField('this-facility.value').val("");
            }if(val == 163266){
                jq('#tbl-this-facility').show();
                getField('this-facility.value').val(default_location);
                jq('#tbl-other-facility').hide();
                getField('other-facility.value').val("");
            }
        }
        var negativeReferralServicesSelected = function(){
            var val = jq(this).val();
            if(val == 5622 ){
                jq('#tbl-specify-referral').show();
            }else {
                jq('#tbl-specify-referral').hide();
                getField('specify-referral.value').val("");
            }

        }

        var hasNegativeReferralSelected = function () {
            var val = jq(this).val();
            if (val == 1065) {
                jq('#tbl-neg-services-referred').show();
                jq("#neg-services-referred input[type=checkbox]").prop("disabled",false);
            }else{
                jq('#tbl-neg-services-referred').hide();
                jq("#neg-services-referred input[type=checkbox]").prop("disabled",true);
                jq("#neg-services-referred input[type=checkbox]").prop("checked",false);
                jq('#tbl-specify-referral').hide();
                getField('specify-referral.value').val("");
            }
        }

        var recencyTestingSelected = function () {
            var val = jq(this).val();
            if (val == 1065) {
                jq("#tbl-recency-id").show();
                jq('#rt-id input[type=text]').val("REC"+mflCode+"-");
            }else{
                jq("#tbl-recency-id").hide();
                jq('#rt-id input[type=text]').val('');
            }
        }

        //Recency Number
        function includePatientsRecencyIdIfExists() {
            var recencyId;
            jq.getJSON('/' + OPENMRS_CONTEXT_PATH + '/kenyaemr/emrUtils/getPatientRecencyId.action', {patientId: patientId}, function (data) {
                if (data != "") {
                    recencyId = data;
                    jq("#tbl-recency-testing").show();
                    jq("#tbl-recency-id").show();
                    jq("#recency-testing input[value=1065]").prop("checked", true);
                    jq('#rt-id input[type=text]').val(recencyId);
                }
            });
        }

        function checkForExistingRecencyIdentifiers() {
            var recencyIdEntered = jq('#rt-id input[type=text]').val();
            jq.getJSON('/' + ctxPath + '/kenyaemr/emrUtils/identifierExists.action', { upn: recencyIdEntered }, function(data) {
                jq('#rtError').hide();
                if (data.recencyIdExists === true) {

                    jq('#rtError').text("A patient with similar Recency Id already exists. Please correct before proceeding");
                    jq('#rtError').show();
                    jq('#rt-id input[type=text]').focus();
                }
            });
        }

        //Before Submit
        beforeSubmit.push(function() {
            var clientConsent = getValue('clientConsent.value');
            var hasDisability = getValue('has-disability.value');
            var resultGiven = getField('results-given.value').val();
            var hivTest1 = getField('hiv-test1-result.value').val();
            var hivTest2 = getField('hiv-test2-result.value').val();
            var kitName1 = getField('kit-name-1.value').val();
            var kitName2 = getField('kit-name-2.value').val();
            var lotNumber1 = getField('lot-number-1.value').val();
            var lotNumber2 = getField('lot-number-2.value').val();
            var expiryDate1 = getField('expiry-date.value').val();
            var expiryDate2 = getField('expiry-date2.value').val();
            var firstKit = getField("kit-name-1.value").val();
            var secondKit = getField("kit-name-2.value").val();
            var disabilityChecked = jq("#disability input:checkbox:checked");
            var rcId = jq('#rt-id input[type=text]').val();
            var hasRecencyId =getValue('recency-testing.value');

            if (disabilityChecked.length == 0 &amp;&amp; hasDisability == 1065) {
                getField('has-disability.error').html('Please specify the disabilty type.').show();
                return false;
            }else{
                getField('has-disability.error').html('Please specify the disabilty type.').hide();
            }

            if(firstKit ==164960 &amp;&amp; secondKit == 164960) {
                getField('kit-name-2.error').html('Cannot use same test kit for both tests.').show();
                return false;
            }
            if (clientConsent == 'true' &amp;&amp; hivTest1 == false ) {      //check hiv test 1 results mandatory
                getField('hiv-test1-result.error').html('Please specify HIV Test 1 results.').show();
                return false;
            }else{
                getField('hiv-test1-result.error').html('Please specify HIV Test 1 results.').hide();
            }
            if (clientConsent == 'true' &amp;&amp; resultGiven == false ) {      //check whether results were given
                getField('results-given.error').html('Please specify whether results were given.').show();
                return false;
            }else{
                getField('results-given.error').html('Please specify whether results were given.').hide();
            }
            if (hivTest1 != false &amp;&amp; kitName1 == false ) {      //check hiv test 1 kitname mandatory
                getField('kit-name-1.error').html('Please specify HIV Test 1 kit name.').show();
                return false;
            }else{
                getField('kit-name-1.error').html('Please specify HIV Test 1 kit name.').hide();
            }
            if (hivTest1 != false &amp;&amp; lotNumber1 == false ) {      //check hiv test 1 lot number mandatory
                getField('lot-number-1.error').html('Please specify HIV Test 1 lot number.').show();
                return false;
            }else{
                getField('lot-number-1.error').html('Please specify HIV Test 1 lot number.').hide();
            }
            if (hivTest1 != false &amp;&amp; expiryDate1 == false ) {      //check hiv test 1 expiry mandatory
                getField('expiry-date.error').html('Please specify HIV Test 1 expiry date.').show();
                return false;
            }else{
                getField('expiry-date.error').html('Please specify HIV Test 1 expiry date.').hide();
            }
            if (hivTest1 == 703 &amp;&amp; hivTest2 == false ) {      //check hiv test 2 if 1 +ve mandatory
                getField('hiv-test2-result.error').html('Please specify HIV Test 2 results.').show();
                return false;
            }else{
                getField('hiv-test2-result.error').html('Please specify HIV Test 2 results.').hide();
            }
            if (hivTest2 != false &amp;&amp; kitName2 == false ) {      //check hiv test 2 kitname mandatory
                getField('kit-name-2.error').html('Please specify HIV Test 2 kit name.').show();
                return false;
            }else{
                getField('kit-name-2.error').html('Please specify HIV Test 2 kit name.').hide();
            }
            if (hivTest2 != false &amp;&amp; lotNumber2 == false ) {      //check hiv test 2 lot number mandatory
                getField('lot-number-2.error').html('Please specify HIV Test 2 lot number.').show();
                return false;
            }else{
                getField('lot-number-2.error').html('Please specify HIV Test 2 lot number.').hide();
            }
            if (hivTest2 != false &amp;&amp; expiryDate2== false ) {      //check hiv test 2 expiry mandatory
                getField('expiry-date2.error').html('Please specify HIV Test 2 expiry date.').show();
                return false;
            }else{
                getField('expiry-date2.error').html('Please specify HIV Test 2 expiry date.').hide();
            }
            if (hivTest2 != false &amp;&amp; kitName1 == kitName2 &amp;&amp; lotNumber1 == lotNumber2 ) {      //check if kitname1 == kitname 2, lot number should be different
                getField('kit-name-2.error').html('Please use a different kit.').show();
                return false;
            }else{
                getField('kit-name-2.error').html('Please use a different kit.').hide();
            }
            if(IS_Recency_SITE==true){
                if(hasRecencyId == 1065) {
                    var recStr = rcId.split("-")[1];
                    if (/^[0-9]{5}$/.test(recStr) === false) {
                        jq("#rtError").text("Invalid Recency ID Format! Should be REC" + mflCode + "- and 5 digits serial number").show();
                        return false;
                    }
                }
            }

        });
    </script>

    <ifMode mode="ENTER">
        <script type="text/javascript">
            jq(function(){
                setValue("encounter-date.value", "");
            });
        </script>
    </ifMode>
    <ifMode mode="EDIT">
        <script type="text/javascript">
            var patientId = <lookup expression="patient.patientId"/>;
            jq(function(){
                //facility referral
                var val = getField("referral-to.value").val();
                var default_location = "<lookup expression="kenyaemr.location()" />";
                if (val == 164407) {
                    jq('#tbl-other-facility').show();
                    jq('#tbl-this-facility').hide();
                    getField('this-facility.value').val("");
                }if(val == 163266){
                    jq('#tbl-this-facility').show();
                    jq('#tbl-other-facility').hide();
                    getField('other-facility.value').val("");
                    getField('this-facility.value').val(default_location);
                }
                //if key pop show which type
                var popTypeSelected = getValue('population-type.value');
                if (popTypeSelected == 164929 ){
                    jq("#key-population").show();
                    jq("#priority-population").hide();
                }
                if (popTypeSelected == 138643 ){
                    jq("#priority-population").show();
                    jq("#key-population").hide();
                }

                var hasNegativeReferralServices = getValue('neg-referral-for.value');
                if (hasNegativeReferralServices == 1065) {
                    jq('#tbl-neg-services-referred').show();
                    jq("#neg-services-referred input[type=checkbox]").prop("disabled",false);
                }
                //First test
                var firstTest = getField("hiv-test1-result.value").val();
                //Negative
                if(firstTest == 664) {

                    jq("#hiv-test2-result select").prop("disabled", true);
                    jq(".kit-name2 select").prop("disabled", true);
                    jq(".lot-number2 input").prop("disabled", true);
                    jq("#expiry-date2 input").prop("disabled", true);
                    // getField('hiv-final-result.value').val(664);
                    changeTheFinalResult(664);
                    jq('#ccc-no input').prop("disabled", true);
                    jq('#negative-referral').show();
                    jq('#fs-referral').hide();
                }
                //Positive
                if(firstTest == 703){
                    jq("#hiv-test2").show();
                    jq("#hiv-test2-result select").prop("disabled", false);
                    jq(".kit-name2 select").prop("disabled", false);
                    jq(".lot-number2 input").prop("disabled", false);
                    jq("#expiry-date2 input").prop("disabled", false);
                    jq('#negative-referral').hide();
                    jq('#fs-referral').hide();
                }
                //Invalid
                if(firstTest == 163611){
                    jq("#hiv-test2").show();
                    jq("#hiv-test2-result select").prop("disabled", false);
                    jq(".kit-name2 select").prop("disabled", false);
                    jq(".lot-number2 input").prop("disabled", false);
                    jq("#expiry-date2 input").prop("disabled", false);
                }
                //Final test
                var secondTest = getField("hiv-test2-result.value").val();
                //Negative
                if(secondTest == 664) {
                    jq(".kit-name2 select").prop("disabled", true);
                    jq(".lot-number2 input").prop("disabled", true);
                    jq("#expiry-date2 input").prop("disabled", true);
                    // getField('hiv-final-result.value').val(664);
                    changeTheFinalResult(664);
                    jq('#ccc-no input').prop("disabled", true);
                    jq('#negative-referral').hide();
                    jq('#fs-referral').hide();
                    jq('#hts-recency-testing').hide();
                }
                //Positive
                if(secondTest == 703){
                    jq(".kit-name2 select").prop("disabled", false);
                    jq(".lot-number2 input").prop("disabled", false);
                    jq("#expiry-date2 input").prop("disabled", false);
                    // getField('hiv-final-result.value').val(703);
                    changeTheFinalResult(703);
                    jq('#ccc-no input').prop("disabled", false);
                    jq('#fs-referral').show();
                    jq('#negative-referral').hide();
                    if(IS_Recency_SITE==true){
                        jq('#hts-recency-testing').show();
                            jq('#tbl-recency-id').show();
                        } else {
                            jq('#hts-recency-testing').hide();
                        }

                }
                //Invalid
                if(secondTest == 163611){
                    jq(".kit-name2 select").prop("disabled", false);
                    jq(".lot-number2 input").prop("disabled", false);
                    jq("#expiry-date2 input").prop("disabled", false);
                    // getField('hiv-final-result.value').val(1138);
                    changeTheFinalResult(1138);
                    jq('#hts-recency-testing').hide();
                }
                //Invalid
                if(secondTest == 1175){
                    jq(".kit-name2 select").prop("disabled", false);
                    jq(".lot-number2 input").prop("disabled", false);
                    jq("#expiry-date2 input").prop("disabled", false);
                    // getField('hiv-final-result.value').val(1138);
                    changeTheFinalResult(1138);
                    jq('#hts-recency-testing').hide();
                }

                //Setting
                var setting = getValue("setting.value");
                //Defaults
                jq("#strategy option[value='161557']").show();  //IT
                jq("#strategy option[value='159939']").show();  //MO
                jq("#strategy option[value='166606']").show();  //SNS
                jq("#strategy option[value='5622']").show();     //O
                jq("#hts-entry-point option[value='5622']").show();     //O
                if (setting == 1537 ) {   //Facility setting selected
                    //Strategy
                    jq("#strategy option[value='164163']").show();  //PITC
                    jq("#strategy option[value='164953']").show();  //NP
                    jq("#strategy option[value='164954']").show();   //VI
                    jq("#strategy option[value='164955']").hide();    //VS
                    jq("#strategy option[value='159938']").hide();    //HB
                    //Entry point
                    jq("#hts-entry-point option[value='5485']").show();    //IPD
                    jq("#hts-entry-point option[value='160542']").show();    //OPD
                    jq("#hts-entry-point option[value='162181']").show();    //PC
                    jq("#hts-entry-point option[value='160552']").show();    //NC
                    jq("#hts-entry-point option[value='160538']").show();    //ANC
                    jq("#hts-entry-point option[value='160456']").show();    //MAT
                    jq("#hts-entry-point option[value='1623']").show();    //PNC
                    jq("#hts-entry-point option[value='160541']").show();    //TB
                    jq("#hts-entry-point option[value='159940']").show();    //VCT
                    jq("#hts-entry-point option[value='162223']").show();    //VMMC
                    jq("#hts-entry-point option[value='160546']").show();    //STI
                    jq("#hts-entry-point option[value='160522']").show();    //ER
                    jq("#hts-entry-point option[value='163096']").hide();    //CT
                    jq("#hts-entry-point option[value='159938']").hide();    //HBT
                    jq("#hts-entry-point option[value='159939']").hide();    //MO

                }else if(setting == 163488 ) {
                    // strategy
                    jq("#strategy option[value='164163']").hide();  //PITC
                    jq("#strategy option[value='164953']").hide();  //NP
                    jq("#strategy option[value='164954']").hide();   //VI
                    jq("#strategy option[value='164955']").show();    //VS
                    jq("#strategy option[value='159938']").show();    //HB
                    //Entry point
                    jq("#hts-entry-point option[value='163096']").show();    //CT
                    jq("#hts-entry-point option[value='159938']").show();    //HBT
                    jq("#hts-entry-point option[value='159939']").show();    //MO
                    jq("#hts-entry-point option[value='5485']").hide();    //IPD
                    jq("#hts-entry-point option[value='160542']").hide();    //OPD
                    jq("#hts-entry-point option[value='162181']").hide();    //PC
                    jq("#hts-entry-point option[value='160552']").hide();    //NC
                    jq("#hts-entry-point option[value='160538']").hide();    //ANC
                    jq("#hts-entry-point option[value='160456']").hide();    //MAT
                    jq("#hts-entry-point option[value='1623']").hide();    //PNC
                    jq("#hts-entry-point option[value='160541']").hide();    //TB
                    jq("#hts-entry-point option[value='159940']").hide();    //VCT
                    jq("#hts-entry-point option[value='162223']").hide();    //VMMC
                    jq("#hts-entry-point option[value='160546']").hide();    //STI
                    jq("#hts-entry-point option[value='160522']").hide();    //ER

                }
                var syphylisTest1Results = getField("syphilis-test-results-1.value").val();

                if(syphylisTest1Results != ""){
                    jq('#dual-results-1').show();
                }

                includePatientsRecencyIdIfExists();

            });

            //Recency Number
            function includePatientsRecencyIdIfExists() {
                var recencyId;
                jq.getJSON('/' + OPENMRS_CONTEXT_PATH + '/kenyaemr/emrUtils/getPatientRecencyId.action', {patientId: patientId}, function (data) {
                    if (data != "") {
                        recencyId = data;
                        jq("#tbl-recency-testing").show();
                        jq("#tbl-recency-id").show();
                        jq("#recency-testing input[value=1065]").prop("checked", true);
                        jq('#rt-id input[type=text]').val(recencyId);
                    }
                });
            }
        </script>
    </ifMode>
    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td>
                    HTS date: <encounterDate id="encounter-date" showTime="true" required="true"/>
                </td>
                <td>HTS Provider : <encounterProvider default="currentUser" /></td>
                <td>Location: <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" /></td>
            </tr>
        </table>
    </div>

    <includeIf velocityTest="$fn.latestObs(167163).getValueCoded().getConceptId() == 1408 || $fn.latestObs(167163).getValueCoded().getConceptId() == 167164">
        <div id="client-hiv-risk-status" class="ke-warning">High Risk Client</div>
    </includeIf>

    <div class="ke-form-content">
        <!-- Population Type  -->
        <fieldset>
            <legend>Population Type</legend>
            <div>
                Population type : &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                <obs conceptId="164930"
                     answerConceptIds="164928,164929,138643"
                     answerLabels="General Population,Key Population,Priority Population" id="population-type"
                     style="radio" />
            </div>
            <table id="key-population">
                <tr>
                    <td>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="105AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="People who inject drugs" style="checkbox" /><br/>
                        <includeIf velocityTest="$patient.gender == 'M'">
                            <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160578AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Men who have sex with men" style="checkbox" /><br/>
                        </includeIf>
                        <includeIf velocityTest="$patient.gender == 'F'">
                            <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160579AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Female sex Worker" style="checkbox" id="female-sex-worker" /><br/>
                        </includeIf>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162277AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="People in prison and other closed settings" style="checkbox"  id="prisoner"/><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="165100"
                             answerLabel="Transgender" style="checkbox"  id="transgender"/><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Other" style="checkbox" id="other" /><br/>
                    </td>
                </tr>
            </table>
            <table id="priority-population">
                <tr>
                    <td>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="159674AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Fisher folk" style="checkbox" /><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Truck driver" style="checkbox" /><br/>
                        <includeIf velocityTest="$patient.gender == 'F'">
                            <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160549AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Adolescent and young girls" style="checkbox" id="adyg" /><br/>
                        </includeIf>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162277AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Prisoner" style="checkbox" /><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Not applicable" style="checkbox" id="other" /><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="165192"
                             answerLabel="Military and other uniformed services" style="checkbox" id="dodOnly" /><br/>

                    </td>
                </tr>
            </table>
            <br />
            <table id="tbl-disability">
                <tr>
                    <td>
                        Does client have any disability? &#160;&#160;&#160;&#160;&#160;
                        <obs id="has-disability" conceptId="164951"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                        <br/>
                    </td>
                </tr>
                <tr id="disability">
                    <td>  Please indicated the type of disability : <br/>
                        <obs conceptId="162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="120291AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Hearing impairment" style="checkbox" /><br/>
                        <obs conceptId="162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="147215AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Visual impairment" style="checkbox" /><br/>
                        <obs conceptId="162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="151342AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Mentally Challenged" style="checkbox"  /><br/>
                        <obs conceptId="162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="164538AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Physically Challenged" style="checkbox" /><br/>
                        <obs conceptId="162558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Other" style="checkbox" id="has-other-disability" /><br/>

                        <table id="tbl-other-disability">
                            <tr>
                                <td>  &#160;&#160;&#160; Specify :
                                    <obs id="other-disability" conceptId="160632" />
                                    &#160;&#160;&#160;
                                </td>
                            </tr>
                        </table>

                    </td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>HIV Test History</legend>
            <table id="tbl-ever-tested">
                <tr>
                    <td>
                        Has the client ever been tested for HIV by a HTS provider? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="ever-tested" conceptId="164401AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                        &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                    </td>
                    <td> Duration in months since the last test:
                        <obs id="duration_months" conceptId="159813"
                        />
                        &#160;&#160;&#160;
                    </td>
                </tr>
            </table>
            <table id="tbl-hiv-selftest">
                <tr>
                    <td>Has the client done HIV self test in the last 12 months? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs class="hb-self-test" conceptId="164952"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             id="client-done-test"
                             style="radio"
                        />
                    </td>
                </tr>
                <tr id="willingness-share-results">
                    <td>Is client willing to share results? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="share-results" conceptId="165153"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio"
                        />
                    </td>
                </tr>

                <tr id="test-results">
                    <td>Self test results? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="results" conceptId="165233"
                             answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="SKT POSITIVE,SKT NEGATIVE"
                             style="radio"
                        />
                    </td>
                    <td>&#160;&#160;&#160;&#160; Date of self test
                        <obs id="date-of-self-test" conceptId="164400AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false"
                        />
                    </td>
                </tr>

            </table>
        </fieldset>
        <fieldset id="hts-setting">
            <legend>Setting</legend>
            <table id="tbl-setting">
                <tr>
                    <td>HTS Setting: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="setting" conceptId="165215"  answerConceptIds="1537AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,163488AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Facility,Community" required="true" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="hts-approach">
            <legend>Approach</legend>
            <table id="tbl-approach">
                <tr>
                    <td>HTS Approach: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="approach" conceptId="163556"  answerConceptIds="164163,164953"
                             style="dropdown" answerLabels="Provider Initiated Testing(PITC),Client Initiated Testing (CITC)" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>HTS Strategy</legend>
            <table id="tbl-hts-strategy">
                <tr>
                    <td>Indicate HTS strategy used: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs class="hts-strategy"
                             id="strategy"
                             conceptId="164956"
                             answerConceptIds="164163AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               164953,
                                               164954,
                                               164955,
                                               159938AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               159939AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               161557AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               166606AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="HP: Hospital Patient Testing,
                                           NP: HTS for non-patients,
                                           VI:Integrated VCT Center,
                                           Stand Alone VCT Center,
                                           Home Based Testing,
                                           MO: Mobile Outreach HTS,
                                           Index testing,
                                           SNS - Social Networks,
                                           O: Others"
                             required="true"
                             />

                    </td>
                    <td>
                        <table id="tbl-other-strategy">
                            <tr>
                                <td>  &#160;&#160;&#160; Specify :
                                    <obs id="other-strategy" conceptId="163761" />
                                    &#160;&#160;&#160;
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>HTS Entry Point</legend>
            <table id="tbl-hts-entry-point">
                <tr>
                    <td>Indicate HTS entry point: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="hts-entry-point"
                             conceptId="160540"
                             answerConceptIds="5485,
                                               160542,
                                               162181,
                                               160552,
                                               160538,
                                               160456,
                                               1623,
                                               160541,
                                               159940,
                                               162223,
                                               160546,
                                               160522,
                                               163096,
                                               159938,
                                               159939,
                                               5622"
                             answerLabels="In Patient Department(IPD),
                                           Out Patient Department(OPD),
                                           Peadiatric Clinic,
                                           Nutrition Clinic,
                                           PMTCT - ANC,
                                           PMTCT - MAT,
                                           PMTCT - PNC,
                                           TB,
                                           VCT,
                                           VMMC,
                                           STI Clinic,
                                           Emergency,
                                           Community Testing,
                                           Home Based Testing,
                                           Mobile Outreach,
                                           Other"
                             required="true"
                        />
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="tb-screening">
            <legend>TB Screening</legend>
            <table id="tbl-tb-screening">
                <tr>
                    <td>Tb Screening results: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="tb-screening" conceptId="1659AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="1660AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142177AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1111AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="No TB Signs,Presumed TB,Not Done,On TB Treatment" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>HIV Testing</legend>
            <table id="tbl-consent">
                <tr>
                    <td>Has consent been given? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs class="consent" conceptId="1710AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="clientConsent" required="true"
                             style="yes_no" />
                    </td>
                    <td width="50px"></td>
                    <td><div id="ml-prediction-consent-warning" style="font-style:italic; font-weight: bold; color:Tomato;"></div></td>
                </tr>
            </table>

            <table id="tbl-couple-testing">
                <tr>
                    <td>Client tested as? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="couple-testing" conceptId="164959"
                             answerConceptIds="164957,164958"
                             style="radio" answerLabels="Individual,Couple"/>
                    </td>
                </tr>
            </table>
            <br />

            <table id="tbl-hiv-test">
                <obsgroup groupingConceptId="164410AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                    <tr>
                        <td>&#160;&#160;&#160;&#160; Kit Name
                            <obs class="kit-name"
                                 id="kit-name-1"
                                 conceptId="164962"
                                 answerConceptIds="164960,165351"
                                 style="dropdown" answerLabels="Determine,Dual Kit"
                            />

                        </td>
                        <td>&#160;&#160;&#160;&#160;Lot Number
                            <obs  class="lot-number" id="lot-number-1" conceptId="164964" />
                        </td>
                        <td width="200px">
                            <div id="latest-lot-number">
                                <input type="checkbox" name="last-batch-number" id="latestLotNumber" /> Use last lot number
                                <span id="upnError" class="error"></span>
                            </div>
                        </td>
                        <td>&#160;&#160;&#160;&#160;Expiry Date
                            <obs id="expiry-date" conceptId="162502AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true"
                            />
                        </td>
                        <td>&#160;&#160;&#160;&#160;HIV Test 1 Results:
                            <obs id="hiv-test1-result" conceptId="1040AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,163611AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 style="dropdown" answerLabels="Positive,Negative,Invalid"/>
                        </td>
                        <td>
                            <div id="dual-results-1" style="display:none;" >&#160;&#160;&#160;&#160; Syphilis Results
                                <obs conceptId="299AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     id="syphilis-test-results"
                                     answerConceptIds="1229AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1228AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Negative,Positive"/>
                            </div>
                        </td>
                    </tr>
                </obsgroup>
                <obsgroup groupingConceptId="164410AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                    <tr id="hiv-test2">

                        <td>&#160;&#160;&#160;&#160; Kit Name
                            <obs class="kit-name2"
                                 id="kit-name-2"
                                 conceptId="164962"
                                 answerConceptIds="164960,164961,165351"
                                 style="dropdown" answerLabels="Determine,First Response,Dual Kit"
                            />

                        </td>
                        <td>&#160;&#160;&#160;&#160;Lot Number
                            <obs class="lot-number2"
                                 id="lot-number-2"
                                 conceptId="164964"
                            />
                        </td>
                        <td width="200px">
                            <div id="latest-lot-number2">
                                <input type="checkbox" name="last-batch-number" id="latestLotNumber2" value="1" /> Use last lot number
                                <span id="upnError2" class="error"></span>
                            </div>
                        </td>
                        <td>&#160;&#160;&#160;&#160;Expiry Date
                            <obs id="expiry-date2" conceptId="162501AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true"
                            />
                        </td>
                        <td>&#160;&#160;&#160;&#160;HIV Test 2 Results:
                            <obs id="hiv-test2-result" conceptId="1326AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,163611AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 style="dropdown" answerLabels="Positive,Negative,Invalid"/>
                        </td>

                    </tr>
                </obsgroup>
                <tr>
                    <td>Final Results:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="hiv-final-result" conceptId="159427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1138AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Positive,Negative,Inconclusive"/>
                    </td>
                    <td>
                        <table id="tbl-results-given">
                            <tr>
                                <td>&#160;&#160;&#160;&#160;Results given to client?&#160;&#160;&#160;&#160;
                                    <obs class="result-given" conceptId="164848AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         style="dropdown" answerLabels="YES,NO" id="results-given"/>
                                      <span style="color:red;"><strong>*</strong></span>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td width="50px"></td>
                    <td><div id="ml-prediction-results-warning" style="font-style:italic; font-weight: bold; color:Tomato;"></div></td>
                </tr>
            </table>
            <br />
            <table id="tbl-discordant">
                <tr>
                    <td>Couple is discordant: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="couple-discordant" conceptId="6096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="YES,NO,N/A"/>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="fs-referral">
            <legend>Referral</legend>
            <table id="tbl-referral">
                <tr>
                    <td>Referral for: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="referral-for" conceptId="1887AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="162082AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               162050AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               164461AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Confirmatory test,
                                                         Comprehensive care center,
                                                         DBS for PCR" />
                    </td>
                </tr>
                <tr>
                    <td>Referral to:  &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="referral-to" conceptId="160481AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="163266AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               164407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="dropdown" answerLabels="This health facility,Other health facility" />
                    </td>
                    <td>
                        <br/>
                        <table id="tbl-other-facility">
                            <tr>
                                <td>  &#160;&#160;&#160; Facility name :
                                    <obs id="other-facility" conceptId="161550AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                    &#160;&#160;&#160;
                                </td>
                            </tr>
                        </table>
                    </td> <td>
                    <br/>
                    <table id="tbl-this-facility">
                        <tr>
                            <td>  &#160;&#160;&#160; Name :
                                <obs id="this-facility" conceptId="161550AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                &#160;&#160;&#160;
                            </td>
                        </tr>
                    </table>
                </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="negative-referral">
            <legend>Referral</legend>
            <table id="tbl-neg-referral">
                <tr>
                    <td> Client referred for other services:
                    </td>
                    <td>
                        <obs id="neg-referral-for" conceptId="165093"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                        <br/>
                    </td>
                    <td> &#160;&#160;&#160;&#160;</td>
                    <td>
                        <table id="tbl-neg-services-referred">
                            <obsgroup groupingConceptId="163180">
                                <tr id="neg-services-referred">
                                    <td>  Referred for which services: <br/><br/>
                                        <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="165276"
                                             answerLabel="Risk reduction counselling" style="checkbox" /><br/>
                                        <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="159612AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                             answerLabel="Safer sex practices" style="checkbox" /><br/>
                                        <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162223AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                             answerLabel="VMMC" style="checkbox" /><br/>
                                        <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="190AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                             answerLabel="Condom use counselling" style="checkbox" /><br/>
                                        <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1691AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                             answerLabel="Post-exposure prophylaxis" style="checkbox" /><br/>
                                    </td><td></td><td>
                                    <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="167125"
                                         answerLabel="Prevention and treatment of STIs" style="checkbox" /><br/>
                                    <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="118855AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerLabel="Substance abuse and mental health treatment" style="checkbox" /><br/>
                                    <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="141814AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerLabel="Prevention of GBV" style="checkbox" /><br/>
                                    <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1370AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerLabel="HIV testing and re-testing" style="checkbox" /><br/>
                                    <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="166536"
                                         answerLabel="Pre-Exposure Prophylaxis" style="checkbox" /><br/>
                                    <obs conceptId="1272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerLabel="Other" style="checkbox" /><br/>
                                </td>
                                </tr>
                            </obsgroup>
                        </table>
                    </td>
                    <td>
                        <br/>
                        <table id="tbl-specify-referral">
                            <tr>
                                <td>  &#160;&#160;&#160; Specify :
                                    <obs id="specify-referral" conceptId="164359AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                    &#160;&#160;&#160;
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </fieldset>
        <includeIf velocityTest="$patient.age &gt; 14">
        <fieldset id="hts-recency-testing">
            <legend>Recency screening</legend>
            <table id="tbl-recency-testing">
                <tr>
                    <td>Has recency screening been done? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs id="recency-testing" conceptId="163777AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr id="tbl-recency-id">
                    <td> Recency Id :&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <span id="rt-id"><patient id="rt_id" field="identifier" identifierTypeId="fd52829a-75d2-4732-8e43-4bff8e5b4f1a" required="false" /></span>
                        <span id="rtError" class="error"></span>
                    </td>
                </tr>
            </table>
        </fieldset>
        </includeIf>
        <fieldset>
            <legend>Remarks </legend>
            <table id="tbl-remarks">
                <tr>
                    <td> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs class="remarks" conceptId="163042AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  rows="5" cols="80"
                        />
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>
    <div class="ke-form-footer">
        <submit/>
    </div>

</htmlform>