<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
-->
<htmlform>
    <style type="text/css">
        table.moh257 {
            border-collapse: collapse;
            background-color: #F3F9FF;
        }
        table.moh257 > tbody > tr > td, table.moh257 > tbody > tr > th {
            border: 1px solid black;
            vertical-align: baseline;
            padding: 3.6px;
            text-align: left;
            background-color: #D9F4D3;
        }
        .left-table {
            display: inline-block; border: 1px solid; float: left;
        }

        .right-table {
            display: inline-block; border: 1px solid;
        }
    </style>
    <script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script>
    <script type="text/javascript">
 //Global variables
        isPediatric = null; // Set later by AJAX lookup
        var bmi = null;
        var SELF = 978;
        var TS = 161642;
        var YES_CONCEPT_ID = 1065;
        var NO_CONCEPT_ID = 1066;
        var ABORTION_CONCEPT_ID = 159896;
        var MISCARRIAGE_CONCEPT_ID = 126127;
        var LIVEBIRTH_CONCEPT_ID = 151849;
        var STILLBIRTH_CONCEPT_ID = 125872;
        var USING_FP_CONCEPT_ID = 965;
        var WANTS_FP_CONCEPT_ID = 1360;
        var NOT_USING_FP_CONCEPT_ID = 160652;
        var WHO_STAGE_1_PEDS_CONCEPT_ID = 1220;
        var WHO_STAGE_2_PEDS_CONCEPT_ID = 1221;
        var WHO_STAGE_3_PEDS_CONCEPT_ID = 1222;
        var WHO_STAGE_4_PEDS_CONCEPT_ID = 1223;
        var WHO_STAGE_1_ADULT_CONCEPT_ID = 1204;
        var WHO_STAGE_2_ADULT_CONCEPT_ID = 1205;
        var WHO_STAGE_3_ADULT_CONCEPT_ID = 1206;
        var WHO_STAGE_4_ADULT_CONCEPT_ID = 1207;
        var WHO_STAGES_PEDS = [ WHO_STAGE_1_PEDS_CONCEPT_ID, WHO_STAGE_2_PEDS_CONCEPT_ID, WHO_STAGE_3_PEDS_CONCEPT_ID, WHO_STAGE_4_PEDS_CONCEPT_ID ];
        var WHO_STAGES_ADULT = [ WHO_STAGE_1_ADULT_CONCEPT_ID, WHO_STAGE_2_ADULT_CONCEPT_ID, WHO_STAGE_3_ADULT_CONCEPT_ID, WHO_STAGE_4_ADULT_CONCEPT_ID ];
        var pAge = parseInt('<lookup expression="patient.age"/>');
        var GREENCARD_VELOCITY = "<lookup expression="kenyaemr.GreenCardVelocityCalculation()" />";
        var PATIENT_ON_ART = GREENCARD_VELOCITY.split(",")[2].split(":")[1];
        var PATIENT_HAS_BEEN_ON_ART = GREENCARD_VELOCITY.split(",")[3].split(":")[1];
        var REGIMEN_NAME = GREENCARD_VELOCITY.split(",")[4].split(":")[1];
        var REGIMEN_DURATION = GREENCARD_VELOCITY.split(",")[5].split(":")[1];

 var PATIENT_STABLE = "<lookup expression="fn.latestObs(1855).getValueCoded()"/>";

    //Start on jq onready
  jq(function() {
            jq('#person-present input').click(onPersonPresentChange);
            jq('.patient-details :input').prop('disabled', true);
            jq("#screened-sti :input[type=radio]").change(screenedStiSelected);
            jq('.tbl-partner-notification :input').prop('disabled', true);
            //Known allergies
            jq('#known-allergies').change(knownAllergiesSelected);       //boolean
            jq('.allergen :input').prop('disabled', true);
            jq('.reaction :input').prop('disabled', true);
            jq('.severity :input').prop('disabled', true);
            jq('.allergy-date :input').prop('disabled', true);
            //complaints
            jq("#complaints-today").change(complaintSelected);       //boolean
            jq('.complaint :input').prop('disabled', true);
            jq('.complaint-time :input').prop('disabled', true);
            jq('.complaint-date :input').prop('disabled', true);
            //Complaint duration date adjustment
            jq(".complaint-time input").change(complaintDurationInput);
            //Adverse drug reactions
            jq('#adverse-reactions').change(adverseReactionSelected);     //boolean
            jq('.medicine-causing :input').prop('disabled', true);
            jq('.reaction :input').prop('disabled', true);
            jq('.severity :input').prop('disabled', true);
            jq('.adverse-events-onset-date :input').prop('disabled', true);
            jq('.action-taken :input').prop('disabled', true);
            //Chronic illness
            jq('#chronic-illness :input[type=radio]').change(chronicIllnessesSelected);
            jq('.illness-chronic :input').prop('disabled', true);
            jq('.onset-date-chronic-illness :input').prop('disabled', true);
            jq('.drug-chronic-illness :input').prop('disabled', true);
            jq('.dose-chronic-illness :input').prop('disabled', true);
            jq('.units-chronic-illnes :input').prop('disabled', true);
            jq('.frequency-chronic-illness :input').prop('disabled', true);
            jq('.duration-chronic-illness :input').prop('disabled', true);
            jq('.duration-units-illness :input').prop('disabled', true);
            //General examination findings
            jq('#general-exam-findings :input[type=checkbox]').change(generalExamSelected);
            getField('weight.value').change(onWeightOrHeightChange);
            getField('height.value').change(onWeightOrHeightChange);
            getField('encounter-date.value').change(onEncounterDateChange);
            getField('ldl.value').change(viralLoadValidation);
            //fp options
            jq("#fp-category input[type=checkbox]").prop("disabled",true);
            jq("#fp-category input[type=radio]").prop("disabled",true);
            jq('#fp-status :input[type=radio]').change(fpOptionsSelected);
            jq('#male-fp-status :input[type=radio]').change(maleFpOptionsSelected);
            onWeightOrHeightChange();
            onEncounterDateChange();
            returnReasonSelected();
            viralLoadValidation();
            onPersonPresentChange();

            //Differentiated care
        //Stability assessment
              jq("#stability").change(stabilitySelected);       //boolean
              jq("#returnVisitReason select").change(returnReasonSelected);       //non boolean
              jq("#tbl-standard").show();
              jq("#tbl-fast-track").hide();
              jq("#refill-label").hide();
              jq("#refill-date").hide();
              jq('#standard select').prop('disabled', true);
              jq('#fast-track select').prop('disabled', true);

      //Differentiated care

            if(PATIENT_STABLE == 1) {
                jq("#tbl-fast-track").show();
                jq("#tbl-standard").hide();
                jq('#fast-track select').prop('disabled', false);
                jq('#standard select').prop('disabled', true);
                jq("#refill-date").show();
                jq("#refill-label").show();
                // clearHiddenSections([refillDate]);
            }else {
                jq("#tbl-standard").show();
                jq("#tbl-fast-track").hide();
                jq("#refill-label").hide();
                jq("#refill-date").hide();
                jq('#standard select').prop('disabled', false);
                jq('#fast-track select').prop('disabled', true);
            }

            // Because of bug HTML-469, we need a hack to set the right property accessor for datetime obs
            var realId = jq('span#pregdate-abmc input[type=hidden]').attr('name');
            propertyAccessorInfo['pregdate-abmc.value'] = { id: realId , field: dateFieldGetterFunction, setter: dateSetterFunction };
            var realIdyes = jq('span#pregdate-yes input[type=hidden]').attr('name');
            propertyAccessorInfo['pregdate-yes.value'] = { id: realIdyes , field: dateFieldGetterFunction, setter: dateSetterFunction };
            var realIdno = jq('span#pregdate-no input[type=hidden]').attr('name');
            propertyAccessorInfo['pregdate-no.value'] = { id: realIdno , field: dateFieldGetterFunction, setter: dateSetterFunction };
//pregnancy default options
            jq('#anc-number :input').prop('disabled', true);
            jq('#anc-profile :input').prop('disabled', true);
            var fpStatus = getValue('fp-status.value');
            var fpInput = jq('#fp-status');
            if (fpStatus == 965 || fpStatus == 1360) {
                jq("#fp-category input[type=checkbox]").prop("disabled",false);
            }else{
                jq("#fp-category input[type=checkbox]").prop("disabled",true);
                clearHiddenSections([fpInput]);
            }
            jq('input[name=pregoption]').click(function() {
                var option = jq('input[name=pregoption]:checked').val();
                setPregOption(option);
            });
            var initialPregStatus = getValue('pregstatus.value');
            var initialPregOutcome = getValue('pregoutcome.value');
            var initialPregOption = null;
            if (initialPregStatus == YES_CONCEPT_ID &amp;&amp; !initialPregOutcome) {
                initialPregOption = 'yes';
            } else if (initialPregStatus == NO_CONCEPT_ID &amp;&amp; !initialPregOutcome) {
                initialPregOption = 'no';
            } else if (initialPregStatus == NO_CONCEPT_ID &amp;&amp; initialPregOutcome == ABORTION_CONCEPT_ID) {
                initialPregOption = 'ab';
            } else if (initialPregStatus == NO_CONCEPT_ID &amp;&amp; initialPregOutcome == MISCARRIAGE_CONCEPT_ID) {
                initialPregOption = 'mc';
            } else if (initialPregStatus == NO_CONCEPT_ID &amp;&amp; initialPregOutcome == LIVEBIRTH_CONCEPT_ID) {
                initialPregOption = 'lb';
            } else if (initialPregStatus == NO_CONCEPT_ID &amp;&amp; initialPregOutcome == STILLBIRTH_CONCEPT_ID) {
                initialPregOption = 'sb';
            }

            if (initialPregOption) {
                jq('input[name=pregoption][value=' + initialPregOption + ']').prop('checked', true);
                setPregDateField(initialPregOption);
            }
      //prophylaxis validation
          jq('#dispense-ctx').click(onCtxDispenseClick);
          jq('#dispense-dap').click(onDapDispenseClick);
        });
        //End on ready
 function onCtxDispenseClick() {
     var dispensectxselected = getValue('dispense-ctx.value');
     var dispensedapsoneselected = getValue('dispense-dap.value');
     var ctx = jq("#dispense-ctx");
     var dap = jq("#dispense-dap");
     clearHiddenSections([dap]);
     if(dispensectxselected == 1065) {
         jq("#dispense-dap input[value=1065]").prop("checked", false);
         jq('#dispense-dap :input').prop('disabled', true);
         jq('#adherence-dapsone :input').prop('disabled', true);
         jq('#adherence-dapsone :input').prop('checked', false);
     }
     if(dispensectxselected != 1065) {
         jq("#dispense-dap input[value=1065]").prop("checked", false);
         jq('#dispense-dap :input').prop('disabled', false);
         jq('#adherence-dapsone :input').prop('disabled', false);
     }
 }
 function onDapDispenseClick() {
     var dispensedapsoneselected = getValue('dispense-dap.value');
     var dispensectxselected = getValue('dispense-ctx.value');
     var ctx = jq("#dispense-ctx");
     var dap = jq("#dispense-dap");
     clearHiddenSections([ctx]);
     if(dispensedapsoneselected == 1065) {
         jq("#dispense-ctx input[value=1065]").prop("checked", false);
         jq('#dispense-ctx :input').prop('disabled', true);
         jq('#adherence-ctx :input').prop('disabled', true);
         jq('#adherence-ctx :input').prop('checked', false);
     }
     if(dispensedapsoneselected != 1065) {
         jq("#dispense-ctx input[value=1065]").prop("checked", false);
         jq('#dispense-ctx :input').prop('disabled', false);
         jq('#adherence-ctx :input').prop('disabled', false);
     }
 }
 function onCtxAdherenceClick() {
     var adherencectxselected = getValue('adherence-ctx.value');
     var adherencedapsoneselected = getValue('adherence-dapsone.value');
     var ctx = jq("#adherence-ctx");
     var dap = jq("#adherence-dapsone");
     clearHiddenSections([dap]);
     if(adherencectxselected != null) {
         jq('#adherence-dapsone :input').prop("checked", false);
         jq('#adherence-dapsone :input').prop('disabled', true);
     }
     if(adherencectxselected == null) {
         jq('#adherence-dapsone :input').prop("checked", false);
         jq('#dispense-dapsone :input').prop('disabled', false);
     }
 }
 function onDapAdherenceClick() {
     var adherencedapsoneselected = getValue('adherence-dapsone.value');
     var adherencectxselected = getValue('adherence-ctx.value');
     var ctx = jq("#adherence-ctx");
     var dap = jq("#adherence-dapsone");
     clearHiddenSections([ctx]);
     if(adherencedapsoneselected != null) {
         jq('#adherence-ctx :input').prop("checked", false);
         jq('#adherence-ctx :input').prop('disabled', true);
     }
     if(adherencedapsoneselected == null) {
         jq('#adherence-ctx input').prop("checked", false);
         jq('#adherence-ctx :input').prop('disabled', false);
     }
 }
 function onPersonPresentChange() {
            var tbScreeningResults = jq("#tb-screening");
            var nutStatus = jq("#nutritional-status");
            var whostage = jq("#whostage");
            var fpType = jq("#fp-category");
            var fpStatus = jq("#fp-status");
            var maleFpStatus = jq("#male-fp-status");
            var allergiesselected = jq('#known-allergies');
            var complaintsselected = jq('#complaints-today');
            var chronicillnessselected = jq('#chronic-illness');
            var adversereactionsselected = jq('#adverse-reactions');
            var generalexamselected = jq('#general-exam-findings');
            var pregoptionsselected = jq('#preg-options');
            var adultvaccselected = jq('#adult-vacc');
            var childvaccselected = jq('#child-vacc');
            var phdpcondomsselected = jq('#phdp-condoms');
            var phdpdisclosureselected = jq('#phdp-disclosure');
            var phdpsubstanceselected = jq('#phdp-substance-abuse');
            var phdptestingselected = jq('#phdp-testing');
            var phdpstiscreeningselected = jq('#phdp-sti-screening');
            var adherencearvselected = jq('#adherence-arv');
            var adherencectxselected = jq('#adherence-ctx');
            var adherencedapsoneselected = jq('#adherence-dapsone');
            if (getValue('person-present.value') == SELF) {
                //adherence assessment validation
                jq('#adherence-ctx').click(onCtxAdherenceClick);
                jq('#adherence-dapsone').click(onDapAdherenceClick);
                jq('.patient-details :input').prop('disabled', false);
                //art validation
                //On ART hide adherence assessment
                if(PATIENT_ON_ART == "true" &amp;&amp; PATIENT_HAS_BEEN_ON_ART == "true") {
                    jq('#adherence-arv :input').prop('disabled', false);
                }
                if(PATIENT_HAS_BEEN_ON_ART == "false") {
                    jq('#adherence-arv :input').prop('disabled', true);
                }

            } else {
                complaintSelected();
                knownAllergiesSelected();
                chronicIllnessesSelected();
                adverseReactionSelected();

                jq('.patient-details :input').prop('disabled', true);
                clearHiddenSections([tbScreeningResults, nutStatus, whostage, fpType, fpStatus, maleFpStatus, allergiesselected, complaintsselected, adversereactionsselected,
                 chronicillnessselected, generalexamselected, pregoptionsselected, adultvaccselected, childvaccselected, phdpcondomsselected, phdpdisclosureselected,phdpsubstanceselected,
                phdptestingselected, phdpstiscreeningselected, adherencearvselected, adherencectxselected, adherencedapsoneselected]);
                jq('#weight input').val('');
                jq('#height input').val('');
                jq('#systolic input').val('');
                jq('#diastolic input').val('');
                jq('#muac input').val('');
                jq('#calculated-bmi').html('');
                jq('#lmp-date input').val('');
                jq('#anc-number input').val('');
                jq('#diagnosis-type input').val('');
                jq('#treatment-plan textarea').val('');
                jq('#other-vacc input').val('');
            }
        }
    function onWeightOrHeightChange() {
            var display = '';
            var weightKg = parseFloat(getValue('weight.value'));
            var heightM = parseFloat(getValue('height.value')) / 100;
            if (pAge &gt; 14) {
                if (!isNaN(weightKg) &amp;&amp; !isNaN(heightM)) {
                    bmi = weightKg / (heightM * heightM);
                    if (isNaN(bmi) || bmi &lt; 10 || bmi &gt; 50) {
                        display = 'Abnormal value. Were height and height entered correctly?';
                    }
                    else {
                        display = bmi.toFixed(2);
                    }
                }
                //set nutritional status and bmi
                jq('#calculated-bmi').html(display);
                if (bmi &lt; 16) {
                    jq("#nutritional-status input[value=163302]").prop("checked", true);
                } else if (bmi &gt; 16 &amp;&amp; bmi &lt; 18.5) {
                    jq("#nutritional-status input[value=163303]").prop("checked", true);
                } else if (bmi &gt; 18.5 &amp;&amp; bmi &lt; 25) {
                    jq("#nutritional-status input[value=1115]").prop("checked", true);
                } else if (bmi &gt; 25) {
                    jq("#nutritional-status input[value=114413]").prop("checked", true);
                }
            }
        }
     function onEncounterDateChange() {       //Updates the form due to an encounter date change
            var patientId = "<lookup expression="patient.patientId"/>";
            var encDate = getValue('encounter-date.value');
            if(encDate == null) {
                encDate = new Date();
            }
         if(PATIENT_ON_ART =="true") {
             jq('#current-regimen').html(REGIMEN_NAME);
             jq('#current-regimen-time').html(REGIMEN_DURATION);

         }else{
             jq('#current-regimen').html("None");
             jq('#current-regimen-time').html("");
           }
      jq.getJSON('/' + OPENMRS_CONTEXT_PATH + '/kenyaemr/patient/patientUtils/age.action', { patientId: patientId, now: encDate })
                .done(function(data) {
                    onPatientAgeUpdate(data.age);
                });
        }
     //stability selected
     var stabilitySelected = function() {
         var stabilityStatus = getValue('stability.value');
         var tca_reason = getField('returnVisitReason.value').val();
         var refillDate = jq("#refill-date").hide();
         if (stabilityStatus == "false" || stabilityStatus == 1066){
             jq("#tbl-standard").show();
             jq("#tbl-fast-track").hide();
             jq("#refill-label").hide();
             jq("#refill-date").hide();
             jq('#standard select').prop('disabled', false);
             jq('#fast-track select').prop('disabled', true);
             // clearHiddenSections([refillDate]);
         }else {
             jq("#tbl-fast-track").show();
             jq("#tbl-standard").hide();
             jq('#fast-track select').prop('disabled', false);
             jq('#standard select').prop('disabled', true);
         }
     }

     var returnReasonSelected = function() {
         var stabilityStatus = getValue('stability.value');
         var tca_reason = getField('returnVisitReason.value').val();
         if (stabilityStatus == "true" &amp;&amp; tca_reason == 160521){
             jq("#refill-label").show();
             jq("#refill-date").show();
             jq('#refill-label input').prop('disabled', false);
             jq('#refill-date input').prop('disabled', false);
         }else {
             jq("#refill-label").hide();
             jq("#refill-date").hide();
             jq('#refill-label input').prop('disabled', true);
             jq('#refill-date input').prop('disabled', true);
         }
     }

     function onPatientAgeUpdate(age) {    //Updates the form due to a patient age change
            isPediatric = (age &lt; 16);
            jq('#whostage select option').each(function() {
                var concept = parseInt(jq(this).prop('value'));

                if (WHO_STAGES_PEDS.indexOf(concept) >= 0) {
                    jq(this).prop('disabled', !isPediatric);
                }
                else if (WHO_STAGES_ADULT.indexOf(concept) >= 0) {
                    jq(this).prop('disabled', isPediatric);
                }
            });
            jq('#calculated-age').html(age + '/' + (isPediatric ? 'PEDS' : 'ADULT'));
        }
    function setPregOption(option) {      //Sets the pregnancy option
            var YES_CONCEPT_ID = 1065;
            var NO_CONCEPT_ID = 1066;
            switch (option) {
                case 'yes':
                    setValue('pregstatus.value', YES_CONCEPT_ID);
                    setValue('pregoutcome.value', null);
                    jq('#anc-number :input').prop('disabled', false);
                    jq('#anc-profile :input').prop('disabled', false);
                    jq('#fp-status :input').prop('disabled', true);
                    jq("#fp-category input[type=checkbox]").prop("disabled",true);
                    jq("#fp-category input[type=radio]").prop("disabled",false);
                    //Automate EDC Computation
                    var lmpDate = getValue('lmp-date.value');
                    var formattedlmp=moment(moment(lmpDate, 'YYYY-MM-DD').toDate()).format('DD-MMM-YYYY');
                    var expectedDeliveryDate = moment(formattedlmp, "DD-MMM-YYYY").add(280, 'days').format('DD-MMM-YYYY');
                    var lmpDate = getValue('lmp-date.value');
                    var formattedlmp=moment(moment(lmpDate, 'YYYY-MM-DD').toDate()).format('DD-MMM-YYYY');
                    var expectedDeliveryDate = moment(formattedlmp, "DD-MMM-YYYY").add(280, 'days').format('DD-MMM-YYYY');
                    //Find recent EDD if it exists
                    //Using LMP
                    var recentEDD = "<lookup expression="fn.latestObs(5596).getValueDatetime()"/>";
                    var recentLMP = "<lookup expression="fn.latestObs(1427).getValueDatetime()"/>";
                    //Using recent LMP
                    var formattedRecentlmp=moment(moment(recentLMP, 'DD-MMM-YYYY').toDate()).format('DD-MMM-YYYY');
                    var expectedDeliveryDateByRecentLMP = moment(formattedRecentlmp, "DD-MMM-YYYY").add(280, 'days').format('DD-MMM-YYYY');
                    if(recentEDD !=""){
                        getField('pregdate-yes.value').val(recentEDD);
                    }
                    if(recentLMP !="") {
                        getField('pregdate-yes.value').val(expectedDeliveryDateByRecentLMP);
                    }
                    if (lmpDate!=""){
                        getField('pregdate-yes.value').val(expectedDeliveryDate);
                    }else{
                        getField('pregdate-yes.value').val("");
                    }
                    break;
                case 'no':
                    setValue('pregstatus.value', NO_CONCEPT_ID);
                    setValue('pregoutcome.value', null);
                    var edd = jq('#pregdate-yes input').val('');
                    jq('#anc-number :input').prop('disabled', true);
                    jq('#anc-profile :input').prop('disabled', true);
                    jq('#fp-status :input').prop('disabled', false);
                    clearHiddenSections([edd]);
                    break;
                case 'ab':
                    setValue('pregstatus.value', NO_CONCEPT_ID);
                    setValue('pregoutcome.value', ABORTION_CONCEPT_ID);
                    jq('#anc-number :input').prop('disabled', false);
                    break;
                case 'mc':
                    setValue('pregstatus.value', NO_CONCEPT_ID);
                    setValue('pregoutcome.value', MISCARRIAGE_CONCEPT_ID);
                    jq('#anc-number :input').prop('disabled', false);
                    break;
                case 'lb':
                    setValue('pregstatus.value', NO_CONCEPT_ID);
                    setValue('pregoutcome.value', LIVEBIRTH_CONCEPT_ID);
                    jq('#anc-number :input').prop('disabled', false);
                    break;
                case 'sb':
                    setValue('pregstatus.value', NO_CONCEPT_ID);
                    setValue('pregoutcome.value', STILLBIRTH_CONCEPT_ID);
                    jq('#anc-number :input').prop('disabled', false);
                    break;
            }
            setPregDateField(option);
        }
     function setPregDateField(option) {      //Displays the appropriate date field for the given pregnancy option
            var options = [ 'yes', 'no', 'ab', 'mc', 'lb', 'sb' ];
            var labels = {
                yes: 'EDD',
                no: '',
                ab: 'Date of abortion',
                mc: 'Date of miscarriage',
                lb: 'Date of delivery',
                sb: 'Date of delivery'
            };
            var fields = {
                yes: 'pregdate-yes',
                no: null,
                ab: 'pregdate-no',
                mc: 'pregdate-no',
                lb: 'pregdate-no',
                sb: 'pregdate-no'
            };
            jq('#pregdate-label').text(labels[option]);      // Update field label
            jq('#' + fields[option] + '-container').show();    // Show field container of desired option
            options.splice(options.indexOf(option), 1);    // Remove requested option so only non-desired options remain in list
            for (var o = 0; o &lt; options.length; ++o) {    //Clear values and hide containers of the other option fields
                var opt = options[o];
                if (fields[opt] &amp;&amp; (fields[opt] != fields[option])) {
                    setValue(fields[opt] + '.value', null);
                    jq('#' + fields[opt] + '-container').hide();
                }
            }
        }
        var screenedStiSelected = function() {
            var val = jq(this).val();
            var partnerNotification = jq("#tbl-partner-notification");
            if (val == 703){
                jq('.tbl-partner-notification :input').prop('disabled', false);

            }else {
                jq('.tbl-partner-notification :input').prop('disabled', true);
            }
        }
        var fpOptionsSelected = function() {
            var fpStatus = getValue('fp-status.value');
            if (fpStatus == USING_FP_CONCEPT_ID ) {
                jq("#fp-category input[type=checkbox]").prop("disabled",false);
                jq("#fp-category input[type=radio]").prop("disabled",true);
            }
            if (fpStatus == WANTS_FP_CONCEPT_ID  ) {
                jq("#fp-category input[type=checkbox]").prop("disabled",false);
                jq("#fp-category input[type=radio]").prop("disabled",true);
            }
            if (fpStatus == NOT_USING_FP_CONCEPT_ID  ) {
                jq("#fp-category input[type=checkbox]").prop("disabled",true);
                jq("#fp-category input[type=radio]").prop("disabled",false);
            }
        }
        var maleFpOptionsSelected = function() {
            var maleFpStatus = getValue('male-fp-status.value');
            if (maleFpStatus == USING_FP_CONCEPT_ID ) {
                jq("#fp-category input[type=checkbox]").prop("disabled",false);
            }
            if (maleFpStatus == WANTS_FP_CONCEPT_ID  ) {
                jq("#fp-category input[type=checkbox]").prop("disabled",false);
            }
            if (maleFpStatus == NOT_USING_FP_CONCEPT_ID  ) {
                jq("#fp-category input[type=checkbox]").prop("disabled",true);
            }
        }
        function viralLoadValidation(){
            if(getValue('ldl.value') == 1302){
                jq('#vLoadResults :input').prop( "disabled", true );
                jq('#viral-load-value input').val('');
            }
            if(getValue('ldl.value') != 1302){
                jq('#vLoadResults :input').prop( "disabled", false );
            }
        }
        var complaintDurationInput = function() {
            var table = document.getElementById("tbl-complaints-today");
            for (var i = 0, row; row = table.rows[i]; i++) {
                var val = jq(this).closest('tr').find(".complaint-time input").val();
                var encounterDate = getValue('encounter-date.value');
                var formattedComplaintDate = moment(moment(encounterDate, 'YYYY-MM-DD').subtract(val, 'days').toDate()).format('YYYY-MM-DD');
               if(encounterDate ==""){
                   getField('complaint-date-field.error').html('Please add encounter date first').show();

               }else if(val >0 ) {
                    jq(this).closest('tr').find(".complaint-date input").val(formattedComplaintDate);
                }
            }
        }
        var knownAllergiesSelected = function() {
            var val = getValue('known-allergies.value');
            var allergy = jq('.allergen select').val('');
            var reaction = jq('.reaction select').val('');
            var severity = jq('.severity select').val('');
            var date = jq('.allergy-date input').val('');
            if (val == "false" || val == 1066){
                jq('.allergen :input').prop('disabled', true);
                jq('.reaction :input').prop('disabled', true);
                jq('.severity :input').prop('disabled', true);
                jq('.allergy-date :input').prop('disabled', true);
                clearHiddenSections([allergy, reaction, severity, date]);
            }else {
                jq('.allergen :input').prop('disabled', false);
                jq('.reaction :input').prop('disabled', false);
                jq('.severity :input').prop('disabled', false);
                jq('.allergy-date :input').prop('disabled', false);
            }
        }
        var complaintSelected = function() {
            var val = getValue('complaints-today.value');
            var complaint = jq('.complaint select').val('');
            var complaintDuration = jq('.complaint-time input').val('');
            var complaintDate = jq('.complaint-date input').val('');
            if (val == "false" || val == 1066){
                jq('.complaint :input').prop('disabled', true);
                jq('.complaint-time :input').prop('disabled', true);
                jq('.complaint-date :input').prop('disabled', true);
                clearHiddenSections([complaint, complaintDuration, complaintDate]);
            }else {
                jq('.complaint :input').prop('disabled', false);
                jq('.complaint-time :input').prop('disabled', false);
                jq('.complaint-date :input').prop('disabled', false);
            }
        }
        var adverseReactionSelected = function() {
            var val = getValue('adverse-reactions.value');
            var medicineCausing= jq('.medicine-causing select').val('');
            var reaction = jq('.reaction select').val('');
            var severity = jq('.severity select').val('');
            var onsetDate = jq('.adverse-events-onset-date input').val('');
            var action = jq('.action-taken select').val('');

            if (val == "false" || val == 1066){
               // jq('.medicine-causing :input').prop('disabled', true);
                jq('.reaction :input').prop('disabled', true);
                jq('.severity :input').prop('disabled', true);
                jq('.adverse-events-onset-date :input').prop('disabled', true);
                jq('.action-taken :input').prop('disabled', true);
                clearHiddenSections([medicineCausing, reaction, severity, onsetDate, action]);
            }else {
                jq('.medicine-causing :input').prop('disabled', false);
                jq('.reaction :input').prop('disabled', false);
                jq('.severity :input').prop('disabled', false);
                jq('.adverse-events-onset-date :input').prop('disabled', false);
                jq('.action-taken :input').prop('disabled', false);
            }
        }
        var chronicIllnessesSelected = function() {
            var val = getValue('chronic-illness.value');
            var illness = jq('.illness-chronic select').val('');
            var onset = jq('.onset-date-chronic-illness input').val('');
            var drug = jq('.drug-chronic-illness input').val('');
            var dose = jq('.dose-chronic-illness input').val('');
            var units = jq('.units-chronic-illness input').val('');
            var frequency = jq('.frequency-chronic-illness select').val('');
            var duration = jq('.duration-chronic-illness input').val('');
            var durationUnits = jq('.duration-units-illness select').val('');
            if (val == "false" || val == 1066){
                jq('.illness-chronic :input').prop('disabled', true);
                jq('.onset-date-chronic-illness :input').prop('disabled', true);
                jq('.drug-chronic-illness :input').prop('disabled', true);
                jq('.dose-chronic-illness :input').prop('disabled', true);
                jq('.units-chronic-illnes :input').prop('disabled', true);
                jq('.frequency-chronic-illness :input').prop('disabled', true);
                jq('.duration-chronic-illness :input').prop('disabled', true);
                jq('.duration-units-illness :input').prop('disabled', true);
                clearHiddenSections([illness,onset, drug, dose, units, frequency, duration, durationUnits]);
            }else {
                jq('.illness-chronic :input').prop('disabled', false);
                jq('.onset-date-chronic-illness :input').prop('disabled', false);
                jq('.drug-chronic-illness :input').prop('disabled', false);
                jq('.dose-chronic-illness :input').prop('disabled', false);
                jq('.units-chronic-illnes :input').prop('disabled', false);
                jq('.frequency-chronic-illness :input').prop('disabled', false);
                jq('.duration-chronic-illness :input').prop('disabled', false);
                jq('.duration-units-illness :input').prop('disabled', false);
            }
        }
        var generalExamSelected = function(){
            var val = jq(this).val();
            var generalExamsChecked = jq("#general-exam-findings input:checkbox:checked");
            if(val == 1107 &amp;&amp; generalExamsChecked.length ==1){
                jq("#general-exam-findings input[type=checkbox]").prop("disabled",true);
                jq(this).prop("disabled",false);
            }else {
                jq("#general-exam-findings input[type=checkbox]").prop("disabled",false);
                jq("#general-exam-findings input[value=1107]").prop("disabled",true);
            }
            if(generalExamsChecked.length ==0){
                jq("#general-exam-findings input[value=1107]").prop("disabled",false);
            }
        }
        //Clear hidden sections
        clearHiddenSections = function(parentObj) {
            for(var i=0; i &lt; parentObj.length; i++){
                parentObj[i].find('input[type=radio]').each(function() {
                    this.checked = false;
                });
                parentObj[i].find('input[type=checkbox]').each(function() {
                    this.checked = false;
                });
                parentObj[i].find('input[type=text]').each(function() {
                    this.val("");
                });
                parentObj[i].find('select').each(function() {
                    this.selectedIndex =0;
                });
            }
        }
        //Start before submit
        beforeSubmit.push(function() {
            var encounterDate = new Date(getValue('encounter-date.value')).getTime();
            var personPresent =getValue('person-present.value');
            var complaintsToday = getValue('complaints-today.value');           //boolean
            var knownAllergies = getValue('known-allergies.value');            //boolean
            var adverseReactions = getValue('adverse-reactions.value');        // boolean
            var chronicIllness = getValue('chronic-illness.value');            //non boolean
            var nextAptDate = new Date(getValue('next-apt-date.value')).getTime();
            var eddDate = new Date(getValue('pregdate-yes.value')).getTime();
            var dodDate = new Date(getValue('pregdate-no.value')).getTime();
            var stabilityStatus= getValue('stability.value');

            if (complaintsToday == false &amp;&amp; personPresent == SELF) {
                getField('complaints-today.error').html('Please specify  if patient has any complaints today.').show();
                return false;
            }
            if (knownAllergies == false &amp;&amp; personPresent == SELF) {
                getField('known-allergies.error').html('Please specify if patient has any known allergies.').show();
                return false;
            }
            if (adverseReactions == false &amp;&amp; personPresent == SELF) {
                getField('adverse-reactions.error').html('Please specify if patient has any adverse drug reactions.').show();
                return false;
            }
            if (chronicIllness == false &amp;&amp; personPresent == SELF) {
                getField('chronic-illness.error').html('Please specify if patient has any chronic illness.').show();
                return false;
            }
            if (nextAptDate &amp;&amp; encounterDate &gt; nextAptDate) {
                getField('next-apt-date.error').html('Should not be earlier than encounter date').show();
                return false;
            }
            if (personPresent == SELF &amp;&amp; stabilityStatus == false) {
                getField('stability.error').html('Please specify stability status.').show();
                return false;
            }else{
                getField('stability.error').html('Please specify stability status.').hide();
            }
            if (pAge &lt; 16 === true) {
                var fpStatus = getValue('fp-status.value');
                if (fpStatus == USING_FP_CONCEPT_ID || fpStatus == WANTS_FP_CONCEPT_ID) {
                    getField('fp-status.error').html('Pediatric patient too young for FP').show();
                    return false;
                }

                if (getValue('pwp-disclosure.value') == YES_CONCEPT_ID) {
                    getField('pwp-disclosure.error').html('Pediatric patient too young').show();
                    return false;
                }

                if (getValue('pwp-partnertested.value') == YES_CONCEPT_ID) {
                    getField('pwp-partnertested.error').html('Pediatric patient too young').show();
                    return false;
                }
            }
            return true;
        });
    </script>

    <!--&lt;!&ndash; For now HFE requires encounter provider, so we set this to the "Unknown Provider" and hide it (see HTML-471) &ndash;&gt;-->
    <!--<div style="display:none">-->
        <!--<encounterProvider default="ae01b8ff-a4cc-4012-bcf7-72359e852e14" />-->
    <!--</div>-->
    <div class="ke-form-content">
        <table class="moh257" align="center">
            <tbody>
                     <tr>
                        <th rowspan="6">Visit Details</th>
                        <th colspan="2">Date/Location</th>
                        <td>(a)</td>
                        <td>
                            <ifMode mode="ENTER">
                                <script type="text/javascript">
                                    jq(function(){
                                        setValue("encounter-date.value", "");
                                    });
                                </script>
                            </ifMode>
                            <encounterDate id="encounter-date" showTime="false" />
                        </td>
                        <td><strong>Scheduled </strong> <br/>
                            <obs id="visit-scheduled" conceptId="1246AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" required="true" style="yes_no"/>
                        </td>
                    </tr>
                    <tr>
                        <th colspan="2">Type</th>
                        <td>(b)</td>
                        <td>
                            <obs    id="person-present"
                                    conceptId="161643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                    answerConceptIds="978AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,161642AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                    answerLabels="Self (SF),Treatment supporter (TS),Other (give name)"
                                    style="radio"
                                    answerSeparator="&lt;br /&gt;" required="true"/>
                            <obs id="person-present-name" conceptId="160638AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                        </td>
                        <td>
                            <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" />
                        </td>
                    </tr>
                    <tr class="patient-details">
                        <th colspan="2">Blood Pressure</th>
                        <td>(c)</td>
                        <td colspan="2"><obs conceptId="5085AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="systolic" />/<obs conceptId="5086AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="diastolic" />mmHg</td>
                    </tr>
                    <tr class="patient-details">
                        <th colspan="2">Weight</th>
                        <td>(d)</td>
                        <td colspan="2"><obs conceptId="5089AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="weight" />(kg)</td>
                    </tr>
                    <tr class="patient-details">
                        <th colspan="2">Height</th>
                        <td>(e)</td>
                        <td colspan="2"><obs conceptId="5090AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="height" />(cm)</td>
                    </tr>
                    <tr class="patient-details">
                        <th colspan="2">BMI / MUAC </th>
                        <td>(f)</td>
                        <td><span id="calculated-bmi" class="value"></span></td>
                        <td><obs conceptId="1343AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="muac" />(cm)</td>
                    </tr>
                     <tr class="patient-details">
                         <th colspan="3"> WHO Stage </th>
                         <td>(g)</td>
                         <td colspan="2">
                             <obs id="whostage" conceptId="5356AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                             <span class="value"><recentObs conceptId="5356AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/></span>
                             (age: <span id="calculated-age" class="value" />)
                         </td>
                     </tr>
                     <tr>
                         <th colspan="2">Known Allergies</th>
                         <th>
                             <div class="patient-details" >
                                 Patient has any known allergie(s)? &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                                 <obs id="known-allergies" conceptId="160557AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="yes_no" />
                                 <span style="color:red;"><strong>*</strong></span>
                             </div>
                         </th>
                         <td>(h)</td>
                         <td colspan="2">
                                         <table>
                                             <tr>
                                                 <th>Causative agent</th>
                                                 <th>Reaction</th>
                                                 <th>Severity</th>
                                                 <th>Date of Onset</th>
                                             </tr>
                                             <repeat>
                                                 <template>
                                                     <obsgroup groupingConceptId="121689AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                                         <tr>
                                                             <td><obs class="allergen" conceptId="160643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerConceptIds="162543AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,72609AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162544AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162545AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162171AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162546AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162547AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162172AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                            162176AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162548AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162177AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162542AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162536AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162537AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162538AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162539AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162540AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                              	162541AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerLabels="Beef,Caffeine,Chocolate,Dairy Food,Eggs,Fish,Milk Protein,Peanuts,Shellfish,Soy,Strawberries,Wheat,Adhesive Tape,Bee Stings,Dust,Latex,Mold,Pollen,Ragweed,Other"
                                                                      style="dropdown"


                                                             />
                                                             </td>
                                                             <td><obs class="reaction" conceptId="159935AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerConceptIds="1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121629AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,148888AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,148787AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120148AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,108AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,143264AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,118773AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140039AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,139581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,139084AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159098AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                            111061AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117399AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,879AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121677AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159347AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerLabels="Unknown,Anaemia,Anaphylaxis,Angioedema,Arrhythmia,Bronchospasm,Cough,Diarrhea,Dystonia,Fever,Flushing,GI upset,Headache,Hepatotoxicity,Hives,Hypertension,Itching,Mental status change,Musculoskeletal pain,Myalgia,Rash,Other"
                                                                      style="dropdown"
                                                             /></td>
                                                             <td><obs class="severity" conceptId="162760AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="160754AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160755AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160756AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160758AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Mild,Moderate,Severe,Fatal,Unknown" /></td>
                                                             <td><obs class="allergy-date" conceptId="160753AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " /></td>
                                                         </tr>
                                                     </obsgroup>
                                                 </template>
                                                 <render n="1" concept=" " />
                                                 <render n="2" concept=" " />
                                                 <render n="3" concept=" " />
                                                 <render n="4" concept=" " />
                                                 <render n="5" concept=" " />
                                             </repeat>
                                         </table>
                         </td>
                     </tr>
                     <tr class="patient-details">
                         <th>Female LMP</th>
                         <th colspan="2">Date</th>
                         <td>(i)</td>
                         <td colspan="2">
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                                 LMP  <obs id="lmp-date" conceptId="1427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false" />
                             </includeIf>
                             <hr width="0" />
                         </td>
                     </tr>
                     <tr class="patient-details">
                         <th rowspan="2"> Pregnancy </th>
                         <td colspan="2">Status</td>
                         <td>(j)</td>
                         <td id="preg-options">
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                                 <ifMode mode="VIEW" include="true">
                                     Pregnant: <obs id="pregstatus" conceptId="5272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /><br />
                                     Outcome: <obs id="pregoutcome" conceptId="161033AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                 </ifMode>
                                 <ifMode mode="VIEW" include="false">
                                     <input id="pregoption-yes" type="radio" name="pregoption" value="yes" /> Pregnant<br />
                                     <input id="pregoption-no" type="radio" name="pregoption" value="no" /> Not pregnant<br />
                                     <input id="pregoption-ab" type="radio" name="pregoption" value="ab" /> Abortion (AB)<br />
                                     <input id="pregoption-mc" type="radio" name="pregoption" value="mc" /> Miscarriage (MC)<br />
                                     <input id="pregoption-lb" type="radio" name="pregoption" value="lb" /> Live birth<br />
                                     <input id="pregoption-sb" type="radio" name="pregoption" value="sb" /> Still birth<br />
                                     <div style="display: none">
                                         <obs id="pregstatus" conceptId="5272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                         <obs id="pregoutcome" conceptId="161033AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                     </div>
                                 </ifMode>
                             </includeIf>
                         </td>
                         <td>
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                                 ANC No. <obs conceptId="163530AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="anc-number"/> <br></br><br></br>
                             </includeIf>
                         </td>
                     </tr>
                     <tr class="patient-details">
                         <th colspan="2"><span id="pregdate-label"></span></th>
                         <td>(k)</td>
                         <td colspan="2">
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">

                                 <ifMode mode="ENTER" include="true">
                                     <div id="pregdate-yes-container" style="display: none">
                                         <obs id="pregdate-yes" conceptId="5596AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true" />
                                     </div>
                                     <div id="pregdate-no-container" style="display: none">
                                         <obs id="pregdate-no" conceptId="5599AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false" allowTime="false" />
                                     </div>
                                 </ifMode>
                             </includeIf>
                         </td>
                     </tr>
                     <tr>
                         <th colspan="3">ANC/PNC Profile</th>
                         <td>(l)</td>
                         <td colspan="2">
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                                 <obs id="anc-profile" conceptId="1719AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes,No" style="radio" />
                             </includeIf>
                         </td>
                     </tr>
                     <tr>
                         <th rowspan="2">FP Status</th>
                         <th colspan="2">FP/No FP</th>
                         <td>(m)</td>
                         <td colspan="2">
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                             <obs
                                     id="fp-status"
                                     conceptId="160653AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="965AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160652AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1360AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Currently using (FP),Not using (NOFP),Wants (WFP)"
                                     style="radio"/>
                             <hr width="0" />
                             </includeIf>
                             <includeIf velocityTest="$patient.gender == 'M' &amp;&amp; ($patient.age &gt; 10) ">
                                 <obs
                                         id="male-fp-status"
                                         conceptId="160653AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerConceptIds="965AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160652AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1360AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerLabels="Currently using (FP),Not using (NOFP),Wants (WFP)"
                                         style="radio"/>
                                 <hr width="0" />
                             </includeIf>
                         </td>

                     </tr>
                     <tr id="fp-category" >
                         <th colspan="2">Method/Why</th>
                         <td>(n)</td>
                         <td>
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">

                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="190AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Condoms (C)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160570AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Emergency contraceptive pill (ECP)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="780AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Oral contraceptive pills (OC)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5279AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Injectables (INJ)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1359AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Implant (IMP)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5275AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Intrauterine devices (IUD)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="136163AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Lactational amenorrhea (LAM)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5278AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Diaphragm/cervical cap (D)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5277AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Fertility awareness/periodic abstinence (FA)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1472AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Tubal ligation/female sterilization (TL)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1489AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Vasectomy - partner (V)" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162195AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Spermicide" /><br />
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162332AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Undecided" /><br />

                             </includeIf>
                             <includeIf velocityTest="$patient.gender == 'M' &amp;&amp; ($patient.age &gt; 10)">
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                  answerConceptId="190AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                  answerLabel="Condoms" style="checkbox"/>
                             <br/>
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                  answerConceptId="1489AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                  answerLabel="Vasectomy" style="checkbox"/>
                             <br/>
                             <obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                  answerConceptId="162332AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                  answerLabel="Undecided" style="checkbox" id="fp-error"/>
                             </includeIf>
                         </td>
                         <td>
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                             <obs
                                     conceptId="160575AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="160571AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160572AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160573AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Wants to get pregnant (WP),Thinks can't get pregnant (UP),Not sexually active now (NSex)"
                                     style="radio"
                                     answerSeparator="&lt;br /&gt;"/>
                             </includeIf>
                         </td>

                     </tr>
                     <tr class="patient-details">
                         <th rowspan="3">PwP<br />Services<br />(&#10003;)</th>
                         <th colspan="2">Screened CaCx</th>
                         <td>(o)</td>
                         <td colspan="2">
                             <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 10)">
                             <obs conceptId="164934"  answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1118AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Positive,Negative,Not Done" style="radio" />
                             <hr width="0" />
                             </includeIf>
                         </td>
                     </tr>
                     <tr class="patient-details">
                         <th colspan="2">Screened STI</th>
                         <td>(p)</td>
                         <td colspan="2"><obs conceptId="161558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="screened-sti" answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1118AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Positive,Negative,Not Done" style="radio" />
                         </td>
                     </tr>
                     <tr class="tbl-partner-notification">
                         <th colspan="2">STI Partner Notification</th>
                         <td>(q)</td>
                         <td colspan="2">
                             <includeIf velocityTest="($patient.age &gt; 10)">
                             <obs conceptId="164935" answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes,No" style="radio" />
                             </includeIf>
                         </td>
                     </tr>
                     <tr>
                         <th>  Complaints and History of complaints</th>
                         <th colspan="2">
                             <div  class="patient-details" >
                                 Patient having complaint(s) today? <br /><br />
                                 <obs id="complaints-today" conceptId="1154AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="yes_no"/>
                                 <span style="color:red;"><strong>*</strong></span>
                             </div>
                         </th>
                         <td>(r)</td>
                         <td>
                             <table id="tbl-complaints-today">
                                 <tr>
                                     <th style="color: #888">Complaint</th>
                                     <th style="color: #888; text-align: center">Duration</th>
                                     <th style="color: #888; text-align: center">Onset Date</th>
                                 </tr>
                                 <repeat>
                                     <template>
                                         <obsgroup groupingConceptId="1284AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                             <tr>
                                                 <td>
                                                     <obs class="complaint" conceptId="6042AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                          answerConceptIds="151AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,141631AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121543AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,119537AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,148035AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,840AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,131021AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120749AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,871AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120345AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,119574AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,113054AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,206AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,143264AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,143129AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,122496AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,118789AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,141830AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                            141585AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,141128AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,131040AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,114399AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162626AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140070AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,123396AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142247AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,135462AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,139084AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117698AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,116214AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,112989AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,879AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,116558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,114395AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,135595AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,135488AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                             121657AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,144576AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,116334AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,131015AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,111721AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,133028AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,133632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5978AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,133469AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,133027AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,132653AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,125225AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,131034AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5953AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,127777AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,113224AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,131032AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,126535AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                               141597AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,158843AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140941AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,125198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,112200AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160208AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,111525AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,122983AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,832AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                          answerLabels="Abdominal pain,Abnormal Uterine Bleeding,Anxiety,Depression,Back pain,Bloody Urine,Breast Pain,Chest Pain,Cold and Chills,Confusion,Delirium,Convulsions,Seizure,Cough,Crying Infant,Diarrhea,Difficult in breathing,Difficulty in swallowing,Dizziness,Ear Pain,Epigastric Pain,Eye apin,Facial Pain,Fatigue/weakness,Fever,Flank Pain,Vaginal Discharge,Discharge from Penis,Genital Ulcer,Headache,Hearing Loss,Hypotension,Shock,Itchiness/Pruritus,Joint Pain,Leg Pain,Loss of Appetite,Lymphadenopathy,Memory Loss,Coma,Lethargy,Mouth Pain,Mouth Ulceration,Muscle cramps,Muscle Pain,Nausea,Neck Pain,Night sweats,Numbness,Pain when Swallowing,Pelvic Pain,Poor Vision,Rash,Red Eye,Running/Blocked nose,Scrotal Pain,Shoulder Pain,
                                                       Sleep Disturbance,Sore Throat,Excessive Sweating,Swollen Legs,Tremors,Urinary Symptoms,Vertigo,Vomiting,Weight Loss,Other"
                                                          style="dropdown"
                                                     />
                                                 </td>
                                                 <td><obs class="complaint-time" conceptId="159368AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id ="complaint-duration"  /></td>
                                                 <td>
                                                     <obs class="complaint-date" conceptId="159948AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id ="complaint-date-field"
                                                          allowFutureDates="false"/>
                                                 </td>
                                             </tr>
                                         </obsgroup>
                                     </template>
                                     <render n="1" concept="Drug"/>
                                     <render n="2" concept="Drug"/>
                                     <render n="3" concept="Drug"/>
                                     <render n="4" concept="Drug"/>
                                     <render n="5" concept="Drug"/>
                                 </repeat>
                             </table>
                             <hr width="0" />
                         </td>
                         <td>  <strong>Clinical Notes</strong><br/>
                             <obs conceptId="160430AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" cols="60" id="clinical-notes"/>
                                       <span class="value"><recentObs conceptId="160430AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/></span>
                         </td>
                     </tr>
                     <tr class="patient-details" id="general-exam-findings">
                         <th colspan="2">General Examination Findings </th>
                         <th>Findings</th>
                         <td>(s)</td>
                         <td colspan="2">
                             <div style="float: left" >
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1107AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="None" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="136443AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Jaundice" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="460AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Oedema" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5334AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Oral thrush" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5245AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Pallor" /><br />

                             </div>
                             <div style="float: left">

                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="140125AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Finger Clubbing" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="126952AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Lymph Node Axillary" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="143050AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Cyanosis" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="126939AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Lymph Nodes Inguinal" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="823AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Wasting" />

                             </div>
                             <div>
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="142630AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Dehydration" /><br />
                                 <obs conceptId="162737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="116334AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Lethargic" /><br />
                                </div>
                         </td>
                     </tr>
                     <tr class="patient-details">
                         <th>TB screening and Nutrition status</th>
                         <th colspan="2">Status</th>
                         <td>(t)</td>
                         <td><strong>TB Screening Results</strong><br/>
                             <obs
                                     conceptId="1659AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1660AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142177AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1662AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="NO signs,TB presumed,TB Rx,Not done (ND)"
                                     style="radio"
                                     answerSeparator="&lt;br /&gt;" id="tb-screening"/>
                             TB RX #
                             <lookup class="value" expression="fn.latestObs(1113).valueDate" />
                             <includeIf velocityTest="!$fn.latestObs(1113)">
                                 <span class="ke-field-instructions">This is calculated from the TB enrolment form</span>
                             </includeIf>
                         </td>
                         <td>
                             <strong>Nutritional Status</strong><br/>
                             <obs    id="nutritional-status"
                                     conceptId="163300AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1115AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,163302AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,163303AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,114413AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Normal,Severe acute malnutrition,Moderate acute malnutrition,Overweight/Obese"
                                     style="radio"
                                     answerSeparator="&lt;br /&gt;"/>
                         </td>
                     </tr>
                     <tr>
                         <th>Adverse Drug Reactions</th>
                         <th colspan="2">
                             <div class="patient-details">
                                 Patient has adverse drug reaction(s)? <br/><br/>
                                 <obs id="adverse-reactions" conceptId="121764AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="yes_no"/>
                                 <span style="color:red;"><strong>*</strong></span>
                             </div>
                         </th>
                         <td>(u)</td>
                         <td colspan="2">
                                         <table>
                                             <tr>
                                                 <th>Medicine Causing Reaction</th>
                                                 <th>Reaction</th>
                                                 <th>Severity</th>
                                                 <th>Date of Onset</th>
                                                 <th>Action taken</th>
                                             </tr>
                                             <repeat>
                                                 <template>
                                                     <obsgroup groupingConceptId="121760AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                                         <tr>
                                                             <td><obs class="medicine-causing"
                                                                     conceptId="160643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerConceptIds="70056AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162298AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,70878AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,155060AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162299AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,155175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,71647AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,72822AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162301AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,73300AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,73667AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,74807AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,75523AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162302AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                            75948AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,77164AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162305AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,77675AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,78280AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,794AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,80106AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,80586AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,80696AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162306AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,81723AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,81724AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,81959AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,82023AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               	82559AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,82900AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,83018AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,767AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162307AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,84309AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162170AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,84795AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,84893AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,86663AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerLabels="Abicavir,ACE inhibitors,Allopurinol,Aminoglycosides,ARBs (angiotensin II receptor blockers),Aspirin,Atazanavir,Carbamazepine,Cephalosporins,Chloroquine,Codeine,Didanosine,Efavirenz,Erythromycins,Ethambutol,Griseofulvin,Heparins,Hydralazine,Isoniazid,Lopinavir/ritonavir,Morphine,Nevirapine,Nitrofurans,Non-steroidal anti-inflammatory drugs,Penicillamine,Penicillin,Phenolphthaleins,Phenytoin,Procainamide,Pyrazinamide,Quinidine,Rifampin,Statins,Stavudine,Sulfonamides,Tenofovir,Tetracycline,Zidovudine,Other"
                                                                      style="dropdown"/>
                                                             </td>
                                                             <td><obs class ="reaction"
                                                                     conceptId="159935AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerConceptIds="1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121629AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,148888AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,148787AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120148AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,108AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,143264AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,142412AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,118773AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,140039AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,139581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,139084AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159098AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                            111061AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117399AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,879AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121677AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159347AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,121AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,512AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerLabels="Unknown,Anaemia,Anaphylaxis,Angioedema,Arrhythmia,Bronchospasm,Cough,Diarrhea,Dystonia,Fever,Flushing,GI upset,Headache,Hepatotoxicity,Hives,Hypertension,Itching,Mental status change,Musculoskeletal pain,Myalgia,Rash,Other"
                                                                      style="dropdown"
                                                             /></td>
                                                             <td><obs  class="severity" conceptId="162760AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  answerConceptIds="160754AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160755AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160756AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160758AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Mild,Moderate,Severe,Fatal,Unknown" /></td>
                                                             <td><obs class="adverse-events-onset-date" conceptId="160753AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " /></td>
                                                             <td>
                                                                 <obs class="action-taken"
                                                                         conceptId="1255AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerConceptIds="1257AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1259AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,981AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1258AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1107AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1260AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                                      answerLabels="CONTINUE REGIMEN,SWITCHED REGIMEN,CHANGED DOSE,SUBSTITUTED DRUG,NONE,STOP,OTHER"
                                                                      style="dropdown"/>
                                                             </td>
                                                         </tr>
                                                     </obsgroup>
                                                 </template>
                                                 <render n="1" concept=" " />
                                                 <render n="2" concept=" " />
                                                 <render n="3" concept=" " />
                                                 <render n="4" concept=" " />
                                                 <render n="5" concept=" " />
                                             </repeat>
                                         </table>
                             <hr width="0" />
                         </td>
                     </tr>
                     <tr>
                         <th rowspan="2">Laboratory<br/>Investigations<br />Done</th>

                         <th colspan="2">HIV Viral Load/CD4 </th>
                         <td>(v)</td>
                         <td>VL Results:
                             <span id="vLoadResults"> <obs conceptId="856AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" showUnits="true" id="viral-load-value"/></span>
                             or
                             <obs conceptId="1305AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1302AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="LDL" id="ldl"/>
                         </td>
                         <td colspan="2">CD4 Count: <obs conceptId="5497AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /> or <obs conceptId="730AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />%</td>
                     </tr>
                     <tr class="patient-details">
                         <th colspan="2">Lab Result(s)</th>
                         <td>(w)</td>
                         <td colspan="2">
                             <dynamicObsContainer id="other-lab-tests" />
                             <div style="text-align: right">
                                 <ifMode mode="VIEW" include="false">
                                     <span class="ke-field-instructions">Add new result for</span>
                                 </ifMode>
                                 <labTestPicker dynamicObsContainerId="other-lab-tests" excludeTests="5497AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,730AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,21AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1619AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,307AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                             </div>
                         </td>
                     </tr>
             <tr>
                 <th> Chronic illnesses and comorbidities </th>
                         <th colspan="2">
                             <div class="patient-details" >
                                 Patient has any chronic illnesse(s)?<br/><br/>
                                 <obs id="chronic-illness" conceptId="162747AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                      answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                      style="radio" answerLabels="Yes,No"
                                 />
                                 <span style="color:red;"><strong>*</strong></span>
                             </div>
                         </th>
                         <td>(x)</td>
                         <td colspan="2">
                             <table id="tbl-chronic-illness">
                                 <tr>
                                     <th style="color: #888">Illness</th>
                                     <th style="color: #888; text-align: center">Onset Date</th>
                                     <th style="color: #888; text-align: center">Drug</th>
                                     <th style="color: #888; text-align: center">Dose</th>
                                     <th style="color: #888; text-align: center">Units</th>
                                     <th style="color: #888; text-align: center">Frequency</th>
                                     <th style="color: #888; text-align: center">Duration</th>
                                     <th style="color: #888; text-align: center">Duration units</th>
                                 </tr>
                                 <repeat>
                                     <template>
                                         <obsgroup groupingConceptId="159392AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                             <tr>
                                                 <td>
                                                     <obs  class="illness-chronic"
                                                             conceptId="1284AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerConceptIds="149019AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,148432AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,153754AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159351AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,119270AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120637AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,145438AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1295AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120576AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,119692AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,120291AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,119481AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,118631AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117855AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117789AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,139071AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,115728AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117399AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117321AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,151342AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,133687AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,115115AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,114662AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,117703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,118976AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerLabels="Alzheimer's Disease and other Dementias,Arthritis,Asthma,Cancer,Cardiovascular diseases,Chronic Hepatitis,Chronic Kidney Disease,Chronic Obstructive Pulmonary Disease(COPD),Chronic Renal Failure,Cystic Fibrosis,Deafness and Hearing impairment,Diabetes,Endometriosis,Epilepsy,Glaucoma,Heart Disease,Hyperlipidaemia,Hypertension,Hypothyroidism,Mental illness,Multiple Sclerosis,Obesity,Osteoporosis,Sickle Cell Anaemia,Thyroid disease"
                                                             style="dropdown"/>
                                                 </td>
                                                 <td><obs class="onset-date-chronic-illness" id="diagnosis-date" conceptId="159948AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false" /></td>
                                                 <td><obs class= "drug-chronic-illness" conceptId="1282AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerClasses="Drug" style="autocomplete" /></td>
                                                 <td><obs class = "dose-chronic-illness" conceptId="1443AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
                                                 <td><obs class ="units-chronic-illness" conceptId="1444AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" size="5" /></td>
                                                 <td>
                                                     <obs class="frequency-chronic-illness"
                                                             conceptId="160855AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerConceptIds="160862AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160863AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160864AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160865AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160858AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160866AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160870AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerLabels="Once daily,Once daily at bedtime,Once daily in the evening,Once daily in the morning,Twice daily,Thrice daily,Four times daily"
                                                     />
                                                 </td>
                                                 <td><obs class="duration-chronic-illness" conceptId="159368AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
                                                 <td>
                                                     <obs class="duration-units-illness"
                                                             conceptId="1732AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                          answerConceptIds="1822AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1072AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1073AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1074AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                          answerLabels="Hours,Days,Weeks,Months" />
                                                 </td>
                                             </tr>
                                         </obsgroup>
                                     </template>
                                     <render n="1" concept="Illness"/>
                                     <render n="2" concept="Illness"/>
                                     <render n="3" concept="Illness"/>
                                     <render n="4" concept="Illness"/>
                                     <render n="5" concept="Illness"/>
                                 </repeat>
                             </table>
                         </td>
             </tr>
                     <tr>
                         <th colspan="3"> Other Medications Dispensed </th>
                         <td>(y)</td>
                         <td colspan="2">
                             <table cellspacing="0">
                                 <tr>
                                     <th style="color: #888">Drug</th>
                                     <th style="color: #888; text-align: center">Dose</th>
                                     <th style="color: #888; text-align: center">Units</th>
                                     <th style="color: #888; text-align: center">Frequency</th>
                                     <th style="color: #888; text-align: center">Duration</th>
                                     <th style="color: #888; text-align: center">Duration units</th>
                                     <th style="color: #888; text-align: center">Dispense date*</th>
                                 </tr>
                                 <repeat>
                                     <template>
                                         <obsgroup groupingConceptId="1442AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                             <tr>
                                                 <td><obs conceptId="1282AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerClasses="Drug" style="autocomplete" /></td>
                                                 <td><obs conceptId="1443AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
                                                 <td><obs conceptId="1444AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" size="5" /></td>
                                                 <td>
                                                     <obs    conceptId="160855AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerConceptIds="160862AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160863AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160864AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160865AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160858AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160866AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160870AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerLabels="Once daily,Once daily at bedtime,Once daily in the evening,Once daily in the morning,Twice daily,Thrice daily,Four times daily"/>
                                                 </td>
                                                 <td><obs conceptId="159368AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
                                                 <td>
                                                     <obs conceptId="1732AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                          answerConceptIds="1822AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1072AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1073AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1074AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                          answerLabels="Hours,Days,Weeks,Months" />
                                                 </td>
                                                 <td><obs id="drug-pickup-date" conceptId="162550AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true" /></td>
                                             </tr>
                                         </obsgroup>
                                     </template>
                                     <render n="1" concept="Drug"/>
                                     <render n="2" concept="Drug"/>
                                     <render n="3" concept="Drug"/>
                                     <render n="4" concept="Drug"/>
                                     <render n="5" concept="Drug"/>
                                 </repeat>
                             </table>
                             <hr width="0" />
                         </td>
                     </tr>
            <tr>
                <th rowspan="2">HIV treatment and CTX prophylaxis</th>
                <th colspan="2">Current ARV Regimen/Prophylaxis</th>
                <td>(z)</td>
                <td colspan="2">
                    <span class="ke-field-instructions">Regimen and dose entered via ARV regimen editor</span>
                    <table cellpadding="0" border="0" cellspacing="5">
                        <tr>
                            <td>Current ARV Regimen:</td>
                            <td> &#160;&#160;&#160;&#160;
                                <span id="current-regimen" class="value"></span>
                                &#160;&#160;&#160;&#160;
                                Duration (in Months):  <span id="current-regimen-time" class="value"></span>
                            </td>
                        </tr>
                        <br />
                        <tr>
                            <td>Cotrimoxazole:</td>
                            <td> &#160;&#160;&#160;&#160;
                                <obs
                                        conceptId="162229AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerLabels="Yes,No,Not applicable (N/A)"
                                        style="radio" id="dispense-ctx"
                                />
                            </td>
                        </tr>
                        <tr>
                            <td>Dapsone:</td>
                            <td> &#160;&#160;&#160;&#160;
                                <obs
                                        conceptId="164940"
                                        answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerLabels="Yes,No,Not applicable (N/A)"
                                        style="radio" id="dispense-dap"
                                />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <th colspan="2">Regimen Dose and Duration</th>
                <td>(aa)</td>
                <td colspan="2" >Duration
                    <obsgroup groupingConceptId="161888AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                        <obs conceptId="159368AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                        Units: <obs conceptId="1732AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                    </obsgroup>
                </td>
            </tr>
            <tr class="patient-details">
                <th colspan="3">Diagnosis</th>
                <td>(ab)</td>
                <td colspan="2">
                    <obs conceptId="6042AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerClasses="Diagnosis" id="diagnosis-type" style="autocomplete"/>
                </td>
            </tr>
            <tr class="patient-details">
                <th colspan="3">Treatment Plan</th>
                <td>(ac)</td>
                <td colspan="2">
                    <obs conceptId="163104AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" rows="1" cols="80" id="treatment-plan"/>
                </td>
            </tr>
            <tr class="patient-details" >
                <th colspan="3">Vaccinations </th>
                <td>(ad)</td>
                <td colspan="2" >
                    <includeIf velocityTest="$patient.age &lt; 16">
                        <table width="30%" id="child-vacc">
                            <tr>
                                <th style="color: #888" align="left">Vaccination</th>
                                <th style="color: #888" align="left">Recent</th>
                                <th style="color: #888" align="left">Count</th>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="886AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="BCG" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(886).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(886).size()"/> </td>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="82215AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="PV" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(82215).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(82215).size()"/> </td>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1423AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Penta" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(1423).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(1423).size()"/> </td>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162342AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="PCV" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(162342).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(162342).size()"/> </td>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="36AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Measles" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(36).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(36).size()"/></td>
                            </tr>
                        </table>
                    </includeIf>
                    <includeIf velocityTest="$patient.age &gt; 15">
                        <table width="30%" id="adult-vacc">
                            <tr>
                                <th style="color: #888" align="left">Vaccination</th>
                                <th style="color: #888" align="left">Recent</th>
                                <th style="color: #888" align="left">Count</th>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="782AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="HBV" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(782).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(782).size()"/> </td>
                            </tr>
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5261AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Flu" style="checkbox" /></td>
                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(5261).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(82215).size()"/> </td>
                            </tr>
                        </table>
                        <table id="other-vacc">
                            <tr>
                                <td><obs conceptId="1198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabel="Other" style="checkbox"
                                /><obs conceptId="160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>

                                <td> <lookup expression="fn.latestObs(1198).valueCoded().equals(5622).obsDateTime"/> </td>
                                <td> <lookup expression="fn.allObs(1198).valueCoded().equals(5622).size()"/> </td>
                            </tr>
                        </table>
                    </includeIf>
                </td>
           </tr>
            <tr class="patient-details">
                <th colspan="3">PHDP Services</th>
                <td>(ae)</td>
                <td colspan="2">
                    <table>
                        <tr>
                            <td>Has the client been given condoms this visit?</td>
                            <td><obs conceptId="159777AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Yes,No,Unknown" id="phdp-condoms"
                                     style="radio"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Has the client been screened for substance abuse?</td>
                            <td><obs conceptId="112603AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Yes,No,Unknown" id="phdp-substance-abuse"
                                     style="radio"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Has the Client disclosed HIV status to their sexually active partner?</td>
                            <td><obs conceptId="159423AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Yes,No,Unknown" id="phdp-disclosure"
                                     style="radio"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Has the client's partner received on-site HIV testing?</td>
                            <td><obs conceptId="161557AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Yes,No,Unknown" id="phdp-testing"
                                     style="radio"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Has the client been screened for STI (in this visit)?</td>
                            <td><obs conceptId="161558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabels="Yes,No,Unknown" id="phdp-sti-screening"
                                     style="radio" />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr class="patient-details" >
                <th colspan="3">Adherence assessment</th>
                <td>(af)</td>
                <td colspan="2">
                    <table cellpadding="0" border="0" cellspacing="5">
                        <tr>
                            <td>ARV:</td>
                            <td> &#160;&#160;&#160;&#160;
                                <obs
                                        conceptId="161652AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerConceptIds="159405AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159406AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerLabels="Good (G),Fair (F),Poor (P),Not applicablee(N/A)" id="adherence-arv"
                                        style="radio"  />
                                <hr width="0" />
                            </td>
                        </tr>
                        <tr>
                            <td>Cotrimoxazole:</td>
                            <td> &#160;&#160;&#160;&#160;
                                <obs
                                        conceptId="161652AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerConceptIds="159405AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159406AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                        answerLabels="Good (G),Fair(F),Poor (P),Not applicablee(N/A)" id="adherence-ctx"
                                        style="radio"
                                />
                            </td>
                        </tr>
                        <tr>
                        <td>Dapsone:</td>
                        <td> &#160;&#160;&#160;&#160;
                            <obs
                                    conceptId="164941"
                                    answerConceptIds="159405AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159406AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159407AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1175AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                    answerLabels="Good (G),Fair (F),Poor (P),Not applicablee(N/A)" id="adherence-dapsone"
                                    style="radio"
                            />
                        </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr class="patient-details" >
                         <th colspan="3">Stability assessment</th>
                         <td>(ag)</td>
                         <td colspan="2">
                             <br />
                                Is the patient stable?  &#160;&#160;&#160;&#160;
                                         <obs conceptId="1855AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="yes_no"
                                             id="stability"/>
                                         <span style="color:red;"><strong>*</strong></span>
                         </td>
            </tr>
            <tr>
                <th colspan="3">Return visit date</th>
                <td>(ah)</td>
                <td>Date:
                    <obs conceptId="5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true"  id="returnVisitDate" required="true" />
                    Reason:
                    <obs conceptId="160288AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" required="true" id="returnVisitReason"
                         answerConceptIds="160523AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1283AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,159382AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160521AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                         answerLabels="Follow up,Lab tests,Counseling,Pharmacy Refill,Other,"
                         style="dropdown"  />
                    <br/>  <br/>
                <div id="refill-label">Refill Date:&#160;&#160;</div>
                <div id="refill-date"><obs conceptId="162549AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true" labelText=" " id="refillVisitDate" /></div>
                </td>
                <td>
                    <table>
                        <tr id="tbl-fast-track">
                            <td>Differentiated Care</td>
                            <td>
                                <obs conceptId="164947" id="fast-track"
                                     answerConceptIds="164942,164943,164944,164945,164946"
                                     style="dropdown"
                                     answerLabels="Standard Care,Fast Track,Community ART Distribution - HCW Led,Community ART Distribution - Peer Led,Facility ART Distribution Group"
                                />
                            </td>
                        </tr>
                        <tr id="tbl-standard">
                            <td>Differentiated Care</td>
                            <td>
                                <obs conceptId="164947" id="standard"
                                     answerConceptIds="164942"
                                     style="dropdown"
                                     answerLabels="Standard Care"
                                />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <th colspan="3">Clinician Initials</th>
                <td>(ai)</td>
                <td><obs conceptId="1473AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
                <td></td>
            </tr>
        </tbody>
        </table>
    </div>
    <div class="ke-form-footer">
        <submit />
    </div>
</htmlform>